import{d as Re,m as Ce,l as Ee,p as Fe,q as N,r as t,f as w,j as i,o as c,c as De,y as o,z as s,i as d,k as f,B as v,R as Ke,x as C,_ as qe}from"./index.13672014.js";const Be={class:"page"},xe=Re({__name:"site-project-list-edit",setup(Ne){const E=Ce();Ee();const O=Fe(),I=[{value:"mqa",label:"MQA"},{value:"accessory",label:"Accessory"},{value:"display",label:"Display"}],Q=[{value:1,label:"Module"},{value:2,label:"Enclosure"},{value:3,label:"Module/Enclosure"}],ee=[{value:"lob",label:"LOB"},{value:"site",label:"Site"},{value:"productLine",label:"Product Line"},{value:"project",label:"Project"},{value:"part",label:"Part/Color"}],n=N(()=>O.getUserInfo.role),M=N(()=>O.getUserInfo.lob),le=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Audit Type",key:"auditType",width:200,valueFormator:e=>Ke(e,Q)}],te=e=>e.id,ae={actions:[{title:"Add Sub",type:"info",key:"add_sub",isShow:e=>!e.part&&(n.value==="super_admin"||n.value==="admin"||n.value==="lob_dri")}],more:[{title:"Delete",type:"error",key:"delete",confirm:{type:"delete",targetName:e=>e.part?e.part:e.project?e.project:e.productLine?e.productLine:e.site?e.site:e.lob?e.lob:null,additionalText:"Delete line will delete sub lines together, and this action cannot be undone!"},isShow:e=>n.value==="super_admin"||n.value==="admin"||n.value==="lob_dri"&&e.role!=="supper_admin"&&e.role!=="admin"&&e.role!="lob_dri"&&e.lob===M.value&&e.site!==null}]},oe=t({}),z=t(1),ne=t(15),a=w({team:"mqa"}),T=async e=>(e.team=l.team||a.team,await C("/get_level_lines",e)),m=t([]),F=t(!1),_=t(!1),ue=async()=>{if(!_.value){F.value=!0;try{m.value=(await T({})).map(e=>({auditType:e.auditType,value:e.lob,label:e.lob})),_.value=!0}finally{F.value=!1}}},S=()=>{(n.value==="super_admin"||n.value==="admin")&&(m.value=[],_.value=!1,a.lob=null),U.value=[],H.value=!1,a.site=null,V.value=[],$.value=!1,a.productLine=null,G.value=[],J.value=!1,a.project=null},se=()=>{U.value=[],H.value=!1,a.site=null,V.value=[],$.value=!1,a.productLine=null,G.value=[],J.value=!1,a.project=null},U=t([]);t(!1);const H=t(!1),V=t([]);t(!1);const $=t(!1),G=t([]);t(!1);const J=t(!1),W=t([]),P=t(!0),ie=()=>{S(),a.team="mqa",z.value=1},y=async()=>{P.value=!0;try{const e=await C("/get_lines_tree",{pageNum:z.value,pageSize:ne.value,...a});W.value=e}finally{P.value=!1}},re=(e,h)=>{e==="add_sub"?Le(h):e==="delete"&&ye(h)},g=t(null),D=t(!1),l=w({}),X=()=>{m.value=[],_.value=!1,l.lob=null,k.value=[],R.value=!1,l.site=null,A.value=[],j.value=!1,l.productLine=null,b.value=[],L.value=!1,l.project=null},K=()=>{if(l.lob){for(const e of m.value)if(e.value===l.lob){l.auditType=e.auditType;break}}else l.auditType=null},de=()=>{k.value=[],R.value=!1,l.site=null,A.value=[],j.value=!1,l.productLine=null,b.value=[],L.value=!1,l.project=null,K()},k=t([]),q=t(!1),R=t(!1),ce=async()=>{if(!R.value){q.value=!0;try{k.value=(await T({lob:l.lob})).map(e=>({auditType:e.auditType,value:e.site,label:e.site})),R.value=!0}finally{q.value=!1}}},pe=()=>{A.value=[],j.value=!1,l.productLine=null,b.value=[],L.value=!1,l.project=null},A=t([]),B=t(!1),j=t(!1),fe=async()=>{if(!j.value){B.value=!0;try{A.value=(await T({lob:l.lob,site:l.site})).map(e=>({auditType:e.auditType,value:e.productLine,label:e.productLine})),j.value=!0}finally{B.value=!1}}},ve=()=>{b.value=[],L.value=!1,l.project=null},b=t([]),x=t(!1),L=t(!1),me=async()=>{if(!L.value){x.value=!0;try{b.value=(await T({lob:l.lob,site:l.site,productLine:l.productLine})).map(e=>({auditType:e.auditType,value:e.project,label:e.project})),L.value=!0}finally{x.value=!1}}},Y=N(()=>{for(const e of ee)if(e.value===u.value)return e.label;return u.value}),u=t(""),be=async e=>{u.value=e,l.auditType=null,l.team=a.team,e==="lob"?(l.lob=null,l.site=null,l.productLine=null,l.project=null):e==="site"?(l.lob=a.lob,l.site=null,l.productLine=null,l.project=null):e==="productLine"?(l.lob=a.lob,l.site=a.site,l.productLine=null,l.project=null):e==="project"?(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=null):(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=a.project),l.part=null,K(),g.value.show()},Le=e=>{l.auditType=e.auditType,l.team=e.team,e.project?(u.value="part",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=e.project):e.productLine?(u.value="project",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=null):e.site?(u.value="productLine",l.lob=e.lob,l.site=e.site,l.productLine=null,l.project=null):e.lob&&(u.value="site",l.lob=e.lob,l.site=null,l.productLine=null,l.project=null),l.part=null,K(),g.value.show()},_e=async()=>{D.value=!0;try{await C("/add_line",l),E.success("Add Success"),g.value.close(),y(),S(),X()}finally{D.value=!1}},ye=async e=>{E.loading("Deleting"),await C("/delete_line",{id:e.id}),E.success("Deleted"),g.value.close(),y(),S(),X()};if(n.value!=="super_admin"&&n.value!=="admin"){const e=M.value||"";m.value=[{value:e,label:e}],_.value=!0,a.lob=e,se()}return(e,h)=>{const p=i("AAFormSelect"),r=i("n-grid-item"),ge=i("AAFormQueryButtons"),Z=i("n-grid"),Ae=i("AAForm"),je=i("AAListButtonAdd"),he=i("AAListHandlers"),Te=i("AAPageList"),Se=i("n-card"),Pe=i("AAFormInputText"),ke=i("AAFormDialog");return c(),De("div",Be,[o(Se,null,{default:s(()=>[d(n)==="super_admin"?(c(),f(Ae,{key:0,labelPlacement:"left",isLoading:P.value,form:a,rules:oe.value},{default:s(()=>[o(Z,{cols:"1 400:2 800:3 1000:4"},{default:s(()=>[o(r,null,{default:s(()=>[o(p,{label:"Team",form:a,formKey:"team",options:I},null,8,["form"])]),_:1}),o(r,null,{default:s(()=>[o(ge,{onQuery:y,onReset:ie})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"])):v("",!0),o(he,null,{default:s(()=>[d(n)==="super_admin"||d(n)==="admin"||d(n)==="lob_dri"?(c(),f(je,{key:0,title:"Add LOB",onClick:h[0]||(h[0]=Oe=>be("lob"))})):v("",!0)]),_:1}),o(Te,{isPaged:!1,isLoading:P.value,columns:le,actions:ae,dataSource:W.value,childrenKey:"sub",rowKey:te,onReady:y,onAction:re,onReload:y},null,8,["isLoading","dataSource"])]),_:1}),o(ke,{ref_key:"editDialogRef",ref:g,what:d(Y),isLoading:D.value,form:l,onConfirm:_e},{default:s(()=>[o(Z,{cols:"1"},{default:s(()=>[d(n)==="super_admin"?(c(),f(r,{key:0},{default:s(()=>[o(p,{disabled:u.value!=="lob",isRequired:!0,label:"Team",form:l,formKey:"team",options:I,onChange:S},null,8,["disabled","form"])]),_:1})):v("",!0),u.value!=="lob"?(c(),f(r,{key:1},{default:s(()=>[o(p,{disabled:d(n)!=="super_admin"&&d(n)!=="admin",isRequired:!0,label:"LOB",form:l,formKey:"lob",options:m.value,loading:F.value,onChange:de,onShow:ue},null,8,["disabled","form","options","loading"])]),_:1})):v("",!0),u.value==="productLine"||u.value==="project"||u.value==="part"?(c(),f(r,{key:2},{default:s(()=>[o(p,{disabled:!l.lob,isRequired:!0,label:"Site",form:l,formKey:"site",options:k.value,loading:q.value,onChange:pe,onShow:ce},null,8,["disabled","form","options","loading"])]),_:1})):v("",!0),u.value==="project"||u.value==="part"?(c(),f(r,{key:3},{default:s(()=>[o(p,{disabled:!l.site,isRequired:!0,label:"Product Line",form:l,formKey:"productLine",options:A.value,loading:B.value,onChange:ve,onShow:fe},null,8,["disabled","form","options","loading"])]),_:1})):v("",!0),u.value==="part"?(c(),f(r,{key:4},{default:s(()=>[o(p,{disabled:!l.productLine,isRequired:!0,label:"Project",form:l,formKey:"project",options:b.value,loading:x.value,onShow:me},null,8,["disabled","form","options","loading"])]),_:1})):v("",!0),o(r,null,{default:s(()=>[o(Pe,{isRequired:!0,label:d(Y)+" Name",form:l,formKey:u.value},null,8,["label","form","formKey"])]),_:1}),o(r,null,{default:s(()=>[o(p,{disabled:u.value!=="lob",isRequired:!0,label:"Audit Type",form:l,formKey:"auditType",options:Q},null,8,["disabled","form"])]),_:1})]),_:1})]),_:1},8,["what","isLoading","form"])])}}});const Qe=qe(xe,[["__scopeId","data-v-47f014fe"]]);export{Qe as default};
