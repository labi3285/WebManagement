import{d as E,m as q,p as J,r as i,q as _,f as R,x as j,j as n,o as K,c as O,a as I,A as S,y as o,z as d,_ as H,l as ie,i as T,T as oe}from"./index.1cc141c4.js";const le={class:"view"},ae={class:"head-info"},ne=E({__name:"items",setup(M,{expose:y}){q();const u=J(),p=i({});_(()=>u.getUserInfo.team),_(()=>u.getUserInfo.role),_(()=>u.getUserInfo.lob),_(()=>u.getUserInfo.id),y({setup:async(r,l)=>{p.value=r,l==="Glue"?a.checkListId=r.checkListId_Glue:l==="Destructive"&&(a.checkListId=r.checkListId_Destructive),a.type=l,l=="Glue"?g.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]:l=="Destructive"&&(g.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]),f()}});const g=i([]),P={actions:[]};i({});const k=i(1),A=i(15),a=R({}),h=i({total:0,list:[]}),m=i(!0),f=async()=>{m.value=!0;try{const r=await j("/accessory/get_check_list_items_page",{pageNum:k.value,pageSize:A.value,...a});h.value=r}finally{m.value=!1}},U=(r,l)=>{},D=async(r,l)=>{};return(r,l)=>{const v=n("AAPageList"),w=n("n-card");return K(),O("div",le,[I("div",ae,[I("p",null,S(p.value.lob)+" / "+S(p.value.site)+" / "+S(p.value.productLine)+" / "+S(p.value.project)+" / "+S(p.value.part),1)]),o(w,null,{default:d(()=>[o(v,{isLoading:m.value,pageNum:k.value,"onUpdate:pageNum":l[0]||(l[0]=e=>k.value=e),pageSize:A.value,"onUpdate:pageSize":l[1]||(l[1]=e=>A.value=e),columns:g.value,actions:P,dataSource:h.value,onAction:U,onChange:D,onReload:f},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const ce=H(ne,[["__scopeId","data-v-f7879a9e"]]),re={class:"page"},de=E({__name:"index",setup(M){const y=q();ie();const u=J();_(()=>u.getUserInfo.team),_(()=>u.getUserInfo.role),_(()=>u.getUserInfo.lob);const p=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(t,s)=>{if(s.part){const c=[];return s.checkListId_Glue&&c.push("Glue"),s.checkListId_Destructive&&c.push("Destructive"),c.join(" | ")}else return`${s.checkListUploaded} / ${s.checkListTotal}`}}],g=t=>t.id,P={width:"260px",actions:[{title:"Preview Glue",type:"default",key:"previewGlue",isShow:t=>t.part!=null&&t.checkListId_Glue!=null},{title:"Preview Destructive",type:"default",key:"previewDestructive",isShow:t=>t.part!=null&&t.checkListId_Destructive!=null},{title:"Upload",type:"info",key:"update"}],more:[]};i({});const k=i(1),A=i(15),a=R({}),h=i([]),m=i(!0),f=async()=>{m.value=!0;try{const t=await j("/accessory/get_lines_tree",{pageNum:k.value,pageSize:A.value,...a});h.value=t}finally{m.value=!1}},U=(t,s)=>{t==="previewGlue"?$(s,"Glue"):t==="previewDestructive"?$(s,"Destructive"):t==="update"?V(s):t==="delete"&&X(s)},D=i(null),r=()=>{D.value.show()},l=t=>{function s(L){var b=L.lastIndexOf("/"),N=L.lastIndexOf("\\"),C=Math.max(b,N);return C<0?L:L.substring(C+1)}const c=document.createElement("a");c.download=s(t),c.style.display="none",c.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+t,document.body.appendChild(c),c.click(),document.body.removeChild(c)},v=i(null),w=i(!1),e=R({}),x=_(()=>e.lob&&e.site&&e.productLine&&e.project&&e.part?`${e.lob}_${e.site}_${e.productLine}_${e.project}_${e.part}`:null),Q=async()=>{e.lob=a.lob,e.site=a.site,e.productLine=a.productLine,e.project=a.project,e.part=a.part,a.project?e.type=a.project:e.type=null,v.value.show()},V=t=>{e.auditType=t.auditType,e.lob=t.lob,e.site=t.site,e.productLine=t.productLine,e.project=t.project,e.part=t.part,e.type=t.project,v.value.show()},W=async()=>{w.value=!0;try{await j("/accessory/upload_check_list",e),y.success("Uploaded"),v.value.close(),f()}finally{w.value=!1}},X=async t=>{y.loading("Deleting"),await j("/accessory/delete_check_list",{id:t.id}),y.success("Deleted"),v.value.close(),f()},F=i(),G=i(),$=async(t,s)=>{F.value.show(),await oe(),G.value.setup(t,s)};return(t,s)=>{const c=n("AAListButtonAdd"),L=n("AAListButtonDownload"),b=n("AAListHandlers"),N=n("AAPageList"),C=n("n-card"),z=n("AADialog"),Y=n("AAFormSiteProject"),B=n("n-grid-item"),Z=n("AAFormSelectJsonWithExcel"),ee=n("n-grid"),te=n("AAFormDialog");return K(),O("div",re,[o(C,null,{default:d(()=>[o(b,null,{default:d(()=>[o(c,{title:"Upload",onClick:Q}),o(L,{title:"Check List Templates",onClick:r})]),_:1}),o(N,{isPaged:!1,isLoading:m.value,columns:p,actions:P,dataSource:h.value,childrenKey:"sub",rowKey:g,onReady:f,onAction:U,onReload:f},null,8,["isLoading","dataSource"])]),_:1}),o(z,{ref_key:"templatesDialogRef",ref:D,title:"Check List Templates",width:"320px"},{default:d(()=>[I("div",{class:"download-link",onClick:s[0]||(s[0]=se=>l("team_Accessory/files/Check_List_Template_Glue.json"))},"Glue Check List Template"),I("div",{class:"download-link",onClick:s[1]||(s[1]=se=>l("team_Accessory/files/Check_List_Template_Destructive.json"))},"Destructive Check List Template")]),_:1},512),o(te,{ref_key:"editDialogRef",ref:v,title:"Upload Check List",width:"400px",isLoading:w.value,form:e,onConfirm:W},{default:d(()=>[o(ee,{cols:"1"},{default:d(()=>[o(B,null,{default:d(()=>[o(Y,{isRequired:!0,selectParent:!1,label:"Site Project",form:e,team:"Accessory",siteProjects:h.value},null,8,["form","siteProjects"])]),_:1}),o(B,null,{default:d(()=>[o(Z,{disabled:!e.part,isRequired:!0,label:"Spec Excel/JSON File",form:e,formKey:"rawJson",validateName:T(x),tips:"The file must match the line selected"+(T(x)?", and with name '"+T(x)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),o(z,{ref_key:"previewDialogRef",ref:F,title:"Check List"},{default:d(()=>[o(ce,{ref_key:"previewRef",ref:G},null,512)]),_:1},512)])}}});const pe=H(de,[["__scopeId","data-v-a35f2714"]]);export{pe as default};
