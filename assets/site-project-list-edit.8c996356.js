import{d as Fe,m as De,l as Ke,p as qe,q as F,r as t,f as ee,j as i,o as c,c as Be,y as n,z as s,i as d,k as v,B as m,R as xe,x as S,_ as Ie}from"./index.fcfeecdc.js";const Ne={class:"page"},Oe=Fe({__name:"site-project-list-edit",setup(Qe){const D=De();Ke();const y=qe(),Q=[{value:"mqa",label:"MQA"},{value:"accessory",label:"Accessory"},{value:"display",label:"Display"}],U=[{value:1,label:"Module"},{value:2,label:"Enclosure"},{value:3,label:"AudioHome"}],le=[{value:"lob",label:"LOB"},{value:"site",label:"Site"},{value:"productLine",label:"Product Line"},{value:"project",label:"Project"},{value:"part",label:"Part/Color"}],z=F(()=>y.getUserInfo.team),o=F(()=>y.getUserInfo.role),K=F(()=>y.getUserInfo.lob),te=e=>{if(K.value){for(const p of K.value)if(p===e)return!0}return!1},ae=async()=>{const e=await S("/refresh_user",{});y.setToken(e.token),y.setUserInfo(e.user)},oe=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Audit Type",key:"auditType",width:200,valueFormator:e=>xe(e,U)}],ne=e=>e.id,ue={actions:[{title:"Add Sub",type:"info",key:"add_sub",isShow:e=>!e.part&&(o.value==="super_admin"||o.value==="admin"||o.value==="lob_dri")}],more:[{title:"Delete",type:"error",key:"delete",confirm:{type:"delete",targetName:e=>e.part?e.part:e.project?e.project:e.productLine?e.productLine:e.site?e.site:e.lob?e.lob:null,additionalText:"Delete line will delete sub lines together, and this action cannot be undone!"},isShow:e=>o.value==="super_admin"||o.value==="admin"||o.value==="lob_dri"&&e.role!=="supper_admin"&&e.role!=="admin"&&e.role!="lob_dri"&&te(e.lob)}]},se=t({}),H=t(1),ie=t(15),a=ee({});o.value==="super_admin"?a.team="mqa":a.team=z.value;const k=async e=>(e.team=l.team||a.team,await S("/get_level_lines",e)),b=t([]),q=t(!1),g=t(!1),re=async()=>{if(!g.value){q.value=!0;try{b.value=(await k({})).map(e=>({auditType:e.auditType,value:e.lob,label:e.lob})),g.value=!0}finally{q.value=!1}}},P=()=>{(o.value==="super_admin"||o.value==="admin")&&(b.value=[],g.value=!1,a.lob=null),M.value=[],V.value=!1,a.site=null,$.value=[],G.value=!1,a.productLine=null,J.value=[],W.value=!1,a.project=null},de=()=>{M.value=[],V.value=!1,a.site=null,$.value=[],G.value=!1,a.productLine=null,J.value=[],W.value=!1,a.project=null},M=t([]);t(!1);const V=t(!1),$=t([]);t(!1);const G=t(!1),J=t([]);t(!1);const W=t(!1),X=t([]),R=t(!0),ce=()=>{P(),o.value==="super_admin"?a.team="mqa":a.team=z.value,H.value=1},A=async()=>{R.value=!0;try{const e=await S("/get_lines_tree",{pageNum:H.value,pageSize:ie.value,...a});X.value=e}finally{R.value=!1}},pe=(e,p)=>{e==="add_sub"?ge(p):e==="delete"&&je(p)},j=t(null),B=t(!1),l=ee({}),Y=()=>{b.value=[],g.value=!1,l.lob=null,C.value=[],E.value=!1,l.site=null,h.value=[],T.value=!1,l.productLine=null,L.value=[],_.value=!1,l.project=null},x=()=>{if(l.lob){for(const e of b.value)if(e.value===l.lob){l.auditType=e.auditType;break}}else l.auditType=null},fe=()=>{C.value=[],E.value=!1,l.site=null,h.value=[],T.value=!1,l.productLine=null,L.value=[],_.value=!1,l.project=null,x()},C=t([]),I=t(!1),E=t(!1),ve=async()=>{if(!E.value){I.value=!0;try{C.value=(await k({lob:l.lob})).map(e=>({auditType:e.auditType,value:e.site,label:e.site})),E.value=!0}finally{I.value=!1}}},me=()=>{h.value=[],T.value=!1,l.productLine=null,L.value=[],_.value=!1,l.project=null},h=t([]),N=t(!1),T=t(!1),be=async()=>{if(!T.value){N.value=!0;try{h.value=(await k({lob:l.lob,site:l.site})).map(e=>({auditType:e.auditType,value:e.productLine,label:e.productLine})),T.value=!0}finally{N.value=!1}}},Le=()=>{L.value=[],_.value=!1,l.project=null},L=t([]),O=t(!1),_=t(!1),_e=async()=>{if(!_.value){O.value=!0;try{L.value=(await k({lob:l.lob,site:l.site,productLine:l.productLine})).map(e=>({auditType:e.auditType,value:e.project,label:e.project})),_.value=!0}finally{O.value=!1}}},Z=F(()=>{for(const e of le)if(e.value===u.value)return e.label;return u.value}),u=t(""),ye=async e=>{u.value=e,l.auditType=null,l.team=a.team,e==="lob"?(l.lob=null,l.site=null,l.productLine=null,l.project=null):e==="site"?(l.lob=a.lob,l.site=null,l.productLine=null,l.project=null):e==="productLine"?(l.lob=a.lob,l.site=a.site,l.productLine=null,l.project=null):e==="project"?(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=null):(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=a.project),l.part=null,x(),j.value.show()},ge=e=>{l.auditType=e.auditType,l.team=e.team,e.project?(u.value="part",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=e.project):e.productLine?(u.value="project",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=null):e.site?(u.value="productLine",l.lob=e.lob,l.site=e.site,l.productLine=null,l.project=null):e.lob&&(u.value="site",l.lob=e.lob,l.site=null,l.productLine=null,l.project=null),l.part=null,x(),j.value.show()},Ae=async()=>{B.value=!0;try{await S("/add_line",l),D.success("Add Success"),j.value.close(),A(),P(),Y(),u.value==="lob"&&o.value==="lob_dri"&&ae()}finally{B.value=!1}},je=async e=>{D.loading("Deleting"),await S("/delete_line",{id:e.id}),D.success("Deleted"),j.value.close(),A(),P(),Y()};if(o.value!=="super_admin"&&o.value!=="admin"){const e=K.value||"";b.value=[{value:e,label:e}],g.value=!0,a.lob=e,de()}return(e,p)=>{const f=i("AAFormSelect"),r=i("n-grid-item"),he=i("AAFormQueryButtons"),w=i("n-grid"),Te=i("AAForm"),Se=i("AAListButtonAdd"),ke=i("AAListHandlers"),Pe=i("AAPageList"),Re=i("n-card"),Ce=i("AAFormInputText"),Ee=i("AAFormDialog");return c(),Be("div",Ne,[n(Re,null,{default:s(()=>[d(o)==="super_admin"?(c(),v(Te,{key:0,labelPlacement:"left",isLoading:R.value,form:a,rules:se.value},{default:s(()=>[n(w,{cols:"1 400:2 800:3 1000:4"},{default:s(()=>[n(r,null,{default:s(()=>[n(f,{label:"Team",form:a,formKey:"team",options:Q},null,8,["form"])]),_:1}),n(r,null,{default:s(()=>[n(he,{onQuery:A,onReset:ce})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"])):m("",!0),n(ke,null,{default:s(()=>[d(o)==="super_admin"||d(o)==="admin"||d(o)==="lob_dri"?(c(),v(Se,{key:0,title:"Add LOB",onClick:p[0]||(p[0]=Ue=>ye("lob"))})):m("",!0)]),_:1}),n(Pe,{isPaged:!1,isLoading:R.value,columns:oe,actions:ue,dataSource:X.value,childrenKey:"sub",rowKey:ne,onReady:A,onAction:pe,onReload:A},null,8,["isLoading","dataSource"])]),_:1}),n(Ee,{ref_key:"editDialogRef",ref:j,what:d(Z),isLoading:B.value,form:l,onConfirm:Ae},{default:s(()=>[n(w,{cols:"1"},{default:s(()=>[d(o)==="super_admin"?(c(),v(r,{key:0},{default:s(()=>[n(f,{disabled:u.value!=="lob",isRequired:!0,label:"Team",form:l,formKey:"team",options:Q,onChange:P},null,8,["disabled","form"])]),_:1})):m("",!0),u.value!=="lob"?(c(),v(r,{key:1},{default:s(()=>[n(f,{disabled:d(o)!=="super_admin"&&d(o)!=="admin",isRequired:!0,label:"LOB",form:l,formKey:"lob",options:b.value,loading:q.value,onChange:fe,onShow:re},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),u.value==="productLine"||u.value==="project"||u.value==="part"?(c(),v(r,{key:2},{default:s(()=>[n(f,{disabled:!l.lob,isRequired:!0,label:"Site",form:l,formKey:"site",options:C.value,loading:I.value,onChange:me,onShow:ve},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),u.value==="project"||u.value==="part"?(c(),v(r,{key:3},{default:s(()=>[n(f,{disabled:!l.site,isRequired:!0,label:"Product Line",form:l,formKey:"productLine",options:h.value,loading:N.value,onChange:Le,onShow:be},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),u.value==="part"?(c(),v(r,{key:4},{default:s(()=>[n(f,{disabled:!l.productLine,isRequired:!0,label:"Project",form:l,formKey:"project",options:L.value,loading:O.value,onShow:_e},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),n(r,null,{default:s(()=>[n(Ce,{isRequired:!0,label:d(Z)+" Name",form:l,formKey:u.value},null,8,["label","form","formKey"])]),_:1}),n(r,null,{default:s(()=>[n(f,{disabled:u.value!=="lob",isRequired:!0,label:"Audit Type",form:l,formKey:"auditType",options:U},null,8,["disabled","form"])]),_:1})]),_:1})]),_:1},8,["what","isLoading","form"])])}}});const He=Ie(Oe,[["__scopeId","data-v-576a8e1d"]]);export{He as default};
