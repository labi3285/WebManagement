import{d as Ee,m as Fe,l as De,p as Ke,q as O,r as t,f as w,j as i,o as c,c as qe,y as o,z as s,i as d,k as v,B as m,R as Be,x as T,_ as xe}from"./index.87770df0.js";const Ie={class:"page"},Ne=Ee({__name:"site-project-list-edit",setup(Oe){const F=Fe();De();const S=Ke(),Q=[{value:"mqa",label:"MQA"},{value:"accessory",label:"Accessory"},{value:"display",label:"Display"}],U=[{value:1,label:"Module"},{value:2,label:"Enclosure"},{value:3,label:"AudioHome"}],ee=[{value:"lob",label:"LOB"},{value:"site",label:"Site"},{value:"productLine",label:"Product Line"},{value:"project",label:"Project"},{value:"part",label:"Part/Color"}],n=O(()=>S.getUserInfo.role),D=O(()=>S.getUserInfo.lob),le=e=>{if(D.value){for(const p of D.value)if(p===e)return!0}return!1},te=async()=>{const e=await T("/refresh_user",{});S.setToken(e.token),S.setUserInfo(e.user)},ae=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Audit Type",key:"auditType",width:200,valueFormator:e=>Be(e,U)}],oe=e=>e.id,ne={actions:[{title:"Add Sub",type:"info",key:"add_sub",isShow:e=>!e.part&&(n.value==="super_admin"||n.value==="admin"||n.value==="lob_dri")}],more:[{title:"Delete",type:"error",key:"delete",confirm:{type:"delete",targetName:e=>e.part?e.part:e.project?e.project:e.productLine?e.productLine:e.site?e.site:e.lob?e.lob:null,additionalText:"Delete line will delete sub lines together, and this action cannot be undone!"},isShow:e=>n.value==="super_admin"||n.value==="admin"||n.value==="lob_dri"&&e.role!=="supper_admin"&&e.role!=="admin"&&e.role!="lob_dri"&&le(e.lob)}]},ue=t({}),z=t(1),se=t(15),a=w({team:"mqa"}),k=async e=>(e.team=l.team||a.team,await T("/get_level_lines",e)),b=t([]),K=t(!1),y=t(!1),ie=async()=>{if(!y.value){K.value=!0;try{b.value=(await k({})).map(e=>({auditType:e.auditType,value:e.lob,label:e.lob})),y.value=!0}finally{K.value=!1}}},P=()=>{(n.value==="super_admin"||n.value==="admin")&&(b.value=[],y.value=!1,a.lob=null),H.value=[],M.value=!1,a.site=null,V.value=[],$.value=!1,a.productLine=null,G.value=[],J.value=!1,a.project=null},re=()=>{H.value=[],M.value=!1,a.site=null,V.value=[],$.value=!1,a.productLine=null,G.value=[],J.value=!1,a.project=null},H=t([]);t(!1);const M=t(!1),V=t([]);t(!1);const $=t(!1),G=t([]);t(!1);const J=t(!1),W=t([]),R=t(!0),de=()=>{P(),a.team="mqa",z.value=1},g=async()=>{R.value=!0;try{const e=await T("/get_lines_tree",{pageNum:z.value,pageSize:se.value,...a});W.value=e}finally{R.value=!1}},ce=(e,p)=>{e==="add_sub"?ye(p):e==="delete"&&Ae(p)},A=t(null),q=t(!1),l=w({}),X=()=>{b.value=[],y.value=!1,l.lob=null,C.value=[],E.value=!1,l.site=null,j.value=[],h.value=!1,l.productLine=null,L.value=[],_.value=!1,l.project=null},B=()=>{if(l.lob){for(const e of b.value)if(e.value===l.lob){l.auditType=e.auditType;break}}else l.auditType=null},pe=()=>{C.value=[],E.value=!1,l.site=null,j.value=[],h.value=!1,l.productLine=null,L.value=[],_.value=!1,l.project=null,B()},C=t([]),x=t(!1),E=t(!1),fe=async()=>{if(!E.value){x.value=!0;try{C.value=(await k({lob:l.lob})).map(e=>({auditType:e.auditType,value:e.site,label:e.site})),E.value=!0}finally{x.value=!1}}},ve=()=>{j.value=[],h.value=!1,l.productLine=null,L.value=[],_.value=!1,l.project=null},j=t([]),I=t(!1),h=t(!1),me=async()=>{if(!h.value){I.value=!0;try{j.value=(await k({lob:l.lob,site:l.site})).map(e=>({auditType:e.auditType,value:e.productLine,label:e.productLine})),h.value=!0}finally{I.value=!1}}},be=()=>{L.value=[],_.value=!1,l.project=null},L=t([]),N=t(!1),_=t(!1),Le=async()=>{if(!_.value){N.value=!0;try{L.value=(await k({lob:l.lob,site:l.site,productLine:l.productLine})).map(e=>({auditType:e.auditType,value:e.project,label:e.project})),_.value=!0}finally{N.value=!1}}},Y=O(()=>{for(const e of ee)if(e.value===u.value)return e.label;return u.value}),u=t(""),_e=async e=>{u.value=e,l.auditType=null,l.team=a.team,e==="lob"?(l.lob=null,l.site=null,l.productLine=null,l.project=null):e==="site"?(l.lob=a.lob,l.site=null,l.productLine=null,l.project=null):e==="productLine"?(l.lob=a.lob,l.site=a.site,l.productLine=null,l.project=null):e==="project"?(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=null):(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=a.project),l.part=null,B(),A.value.show()},ye=e=>{l.auditType=e.auditType,l.team=e.team,e.project?(u.value="part",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=e.project):e.productLine?(u.value="project",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=null):e.site?(u.value="productLine",l.lob=e.lob,l.site=e.site,l.productLine=null,l.project=null):e.lob&&(u.value="site",l.lob=e.lob,l.site=null,l.productLine=null,l.project=null),l.part=null,B(),A.value.show()},ge=async()=>{q.value=!0;try{await T("/add_line",l),F.success("Add Success"),A.value.close(),g(),P(),X(),u.value==="lob"&&n.value==="lob_dri"&&te()}finally{q.value=!1}},Ae=async e=>{F.loading("Deleting"),await T("/delete_line",{id:e.id}),F.success("Deleted"),A.value.close(),g(),P(),X()};if(n.value!=="super_admin"&&n.value!=="admin"){const e=D.value||"";b.value=[{value:e,label:e}],y.value=!0,a.lob=e,re()}return(e,p)=>{const f=i("AAFormSelect"),r=i("n-grid-item"),je=i("AAFormQueryButtons"),Z=i("n-grid"),he=i("AAForm"),Te=i("AAListButtonAdd"),Se=i("AAListHandlers"),ke=i("AAPageList"),Pe=i("n-card"),Re=i("AAFormInputText"),Ce=i("AAFormDialog");return c(),qe("div",Ie,[o(Pe,null,{default:s(()=>[d(n)==="super_admin"?(c(),v(he,{key:0,labelPlacement:"left",isLoading:R.value,form:a,rules:ue.value},{default:s(()=>[o(Z,{cols:"1 400:2 800:3 1000:4"},{default:s(()=>[o(r,null,{default:s(()=>[o(f,{label:"Team",form:a,formKey:"team",options:Q},null,8,["form"])]),_:1}),o(r,null,{default:s(()=>[o(je,{onQuery:g,onReset:de})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"])):m("",!0),o(Se,null,{default:s(()=>[d(n)==="super_admin"||d(n)==="admin"||d(n)==="lob_dri"?(c(),v(Te,{key:0,title:"Add LOB",onClick:p[0]||(p[0]=Qe=>_e("lob"))})):m("",!0)]),_:1}),o(ke,{isPaged:!1,isLoading:R.value,columns:ae,actions:ne,dataSource:W.value,childrenKey:"sub",rowKey:oe,onReady:g,onAction:ce,onReload:g},null,8,["isLoading","dataSource"])]),_:1}),o(Ce,{ref_key:"editDialogRef",ref:A,what:d(Y),isLoading:q.value,form:l,onConfirm:ge},{default:s(()=>[o(Z,{cols:"1"},{default:s(()=>[d(n)==="super_admin"?(c(),v(r,{key:0},{default:s(()=>[o(f,{disabled:u.value!=="lob",isRequired:!0,label:"Team",form:l,formKey:"team",options:Q,onChange:P},null,8,["disabled","form"])]),_:1})):m("",!0),u.value!=="lob"?(c(),v(r,{key:1},{default:s(()=>[o(f,{disabled:d(n)!=="super_admin"&&d(n)!=="admin",isRequired:!0,label:"LOB",form:l,formKey:"lob",options:b.value,loading:K.value,onChange:pe,onShow:ie},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),u.value==="productLine"||u.value==="project"||u.value==="part"?(c(),v(r,{key:2},{default:s(()=>[o(f,{disabled:!l.lob,isRequired:!0,label:"Site",form:l,formKey:"site",options:C.value,loading:x.value,onChange:ve,onShow:fe},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),u.value==="project"||u.value==="part"?(c(),v(r,{key:3},{default:s(()=>[o(f,{disabled:!l.site,isRequired:!0,label:"Product Line",form:l,formKey:"productLine",options:j.value,loading:I.value,onChange:be,onShow:me},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),u.value==="part"?(c(),v(r,{key:4},{default:s(()=>[o(f,{disabled:!l.productLine,isRequired:!0,label:"Project",form:l,formKey:"project",options:L.value,loading:N.value,onShow:Le},null,8,["disabled","form","options","loading"])]),_:1})):m("",!0),o(r,null,{default:s(()=>[o(Re,{isRequired:!0,label:d(Y)+" Name",form:l,formKey:u.value},null,8,["label","form","formKey"])]),_:1}),o(r,null,{default:s(()=>[o(f,{disabled:u.value!=="lob",isRequired:!0,label:"Audit Type",form:l,formKey:"auditType",options:U},null,8,["disabled","form"])]),_:1})]),_:1})]),_:1},8,["what","isLoading","form"])])}}});const ze=xe(Ne,[["__scopeId","data-v-6f4a2a95"]]);export{ze as default};
