import{d as re,m as de,p as me,r as d,q as y,f as I,j as u,o as g,c as ce,y as l,z as a,i as m,k as B,B as w,x as c,U as K,_ as _e}from"./index.fcfeecdc.js";const fe={class:"page"},pe=re({__name:"users-edit",setup(ve){const p=de(),A=me(),T=[{value:"mqa",label:"MQA"},{value:"accessory",label:"Accessory"},{value:"display",label:"Display"}],U=[{value:"admin",label:"Admin"},{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}],v=d([]);async function D(){if(o.value==="super_admin"){const e=s.team||"mqa",t=await c("/get_level_lines",{team:e});v.value=t.map(n=>n.lob)}else if(o.value==="admin"){const e=F.value,t=await c("/get_level_lines",{team:e});v.value=t.map(n=>n.lob)}else v.value=L.value||[]}const F=y(()=>A.getUserInfo.team),o=y(()=>A.getUserInfo.role),L=y(()=>A.getUserInfo.lob),P=e=>{if(L.value){for(const t of L.value)for(const n of e)if(t===n)return!0}return!1},j=y(()=>A.getUserInfo.id),H=[{title:"Account",key:"account",width:200},{title:"Team",key:"team",width:200,isShow:()=>o.value==="super_admin"},{title:"Role",key:"role",width:100,tagOptions:{valueLabels:U,valueTypes:[{value:"admin",type:"error"},{value:"lob_dri",type:"warning"},{value:"lob_auditor",type:"info"}]}},{title:"LOB",key:"lob",width:200,valueFormator:e=>e?e.join(","):""},{title:"Enable",key:"status",width:80,switch:{isNumber:!0,isDisabled:e=>o.value==="admin"&&e.role==="admin"||o.value==="lob_dri"&&(e.role==="lob_dri"||e.role==="admin")||e.id===j.value}},{title:"Create Time",key:"createTime",width:200}],V={actions:[{title:"Change Role",type:"warning",key:"role",isShow:e=>o.value==="super_admin"||o.value==="admin"&&e.role!=="super_admin"&&e.role!=="admin"||o.value==="lob_dri"&&e.role==="lob_auditor"&&P(e.lob)}],more:[{title:"Reset Password",type:"error",key:"reset_password",confirm:{targetKey:"account"},isShow:e=>o.value==="super_admin"||o.value==="admin"&&e.role!=="super_admin"&&e.role!=="admin"||o.value==="lob_dri"&&e.role==="lob_auditor"&&P(e.lob)}]},$=d({}),R=d(1),k=d(15),s=I({});o.value==="super_admin"?s.team="mqa":s.team=F.value;const x=d({total:0,list:[]}),S=d(!0),G=()=>{o.value==="super_admin"?s.team="mqa":s.team=F.value,s.account=null,s.role=null,s.lob=null,R.value=1},_=async()=>{S.value=!0;try{const e=await c("/get_users_page",{pageNum:R.value,pageSize:k.value,...s});x.value=e}finally{S.value=!1}},J=(e,t)=>{e==="role"?le(t):e==="reset_password"?Z(t):e==="delete"&&ee(t)},W=async(e,t)=>{if(e==="status"){const n=t[e];try{await c("/update_user_status",{id:t.id,status:n})}catch{t[e]=n===1?0:1}}},b=d(null),C=d(!1),i=I({}),N=y(()=>{if(o.value==="super_admin")return[{value:"admin",label:"Admin"},{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}];if(o.value==="admin")return[{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}];if(o.value==="lob_dri")return[{value:"lob_auditor",label:"LOB Auditor"}]}),X=async e=>{e?K(i,e):o.value==="lob_dri"?(i.role="lob_auditor",i.lob=L.value):K(i,null),i.team=s.team,b.value.show()},Y=async()=>{C.value=!0;try{await c("/add_user",i),p.success("Add Success"),b.value.close(),_()}finally{C.value=!1}},Z=async e=>{p.loading("Reseting"),await c("/reset_user_password",{id:e.id}),p.success("Password Resetted"),b.value.close(),_()},ee=async e=>{p.loading("Deleting"),await c("/delete_user",{id:e.id}),p.success("Deleted"),b.value.close(),_()};d([]);const O=d(!1),q=d(null),f=I({});async function le(e){K(f,{id:e.id,role:e.role,lob:e.lob}),q.value.show()}async function oe(){O.value=!0;try{await c("/change_user_role",f),p.success("Edit Success"),q.value.close(),_()}finally{O.value=!1}}return(e,t)=>{const n=u("AAFormSelect"),r=u("n-grid-item"),z=u("AAFormInputText"),te=u("AAFormQueryButtons"),E=u("n-grid"),ae=u("AAForm"),se=u("AAListButtonAdd"),ne=u("AAListHandlers"),ie=u("AAPageList"),ue=u("n-card"),Q=u("AAFormSelectMultiple"),M=u("AAFormDialog");return g(),ce("div",fe,[l(ue,null,{default:a(()=>[l(ae,{labelPlacement:"left",isLoading:S.value,form:s,rules:$.value},{default:a(()=>[l(E,{cols:"1 400:2 800:3 1000:4"},{default:a(()=>[m(o)==="super_admin"?(g(),B(r,{key:0},{default:a(()=>[l(n,{label:"Team",form:s,formKey:"team",options:T},null,8,["form"])]),_:1})):w("",!0),l(r,null,{default:a(()=>[l(z,{label:"Account",form:s,formKey:"account"},null,8,["form"])]),_:1}),l(r,null,{default:a(()=>[l(n,{label:"Role",form:s,formKey:"role",options:U},null,8,["form"])]),_:1}),l(r,null,{default:a(()=>[l(n,{label:"LOB",form:s,formKey:"lob",options:v.value,onShow:D},null,8,["form","options"])]),_:1}),l(r,null,{default:a(()=>[l(te,{onQuery:_,onReset:G})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"]),l(ne,null,{default:a(()=>[l(se,{title:m(o)==="lob_dri"?"Add Auditor":"Add User",onClick:t[0]||(t[0]=h=>X(null))},null,8,["title"])]),_:1}),l(ie,{isLoading:S.value,pageNum:R.value,"onUpdate:pageNum":t[1]||(t[1]=h=>R.value=h),pageSize:k.value,"onUpdate:pageSize":t[2]||(t[2]=h=>k.value=h),columns:H,actions:V,dataSource:x.value,onReady:_,onAction:J,onChange:W,onReload:_},null,8,["isLoading","pageNum","pageSize","dataSource"])]),_:1}),l(M,{ref_key:"editDialogRef",ref:b,what:m(o)==="lob_dri"?"Auditor":"User",isLoading:C.value,form:i,onConfirm:Y},{default:a(()=>[l(E,{cols:"1"},{default:a(()=>[m(o)==="super_admin"?(g(),B(r,{key:0},{default:a(()=>[l(n,{isRequired:!0,label:"Team",form:i,formKey:"team",options:T},null,8,["form"])]),_:1})):w("",!0),l(r,null,{default:a(()=>[l(z,{isRequired:!0,label:"Account",form:i,formKey:"account"},null,8,["form"])]),_:1}),l(r,null,{default:a(()=>[l(n,{disabled:m(o)!=="super_admin"&&m(o)!=="admin",isRequired:!0,label:"Role",form:i,formKey:"role",options:m(N)},null,8,["disabled","form","options"])]),_:1}),i.role!=="admin"?(g(),B(r,{key:1},{default:a(()=>[l(Q,{disabled:m(o)!=="super_admin"&&m(o)!=="admin",isRequired:!0,label:"LOB",form:i,formKey:"lob",onShow:D,options:v.value},null,8,["disabled","form","options"])]),_:1})):w("",!0)]),_:1})]),_:1},8,["what","isLoading","form"]),l(M,{ref_key:"editRoleDialogRef",ref:q,title:"Change Role",isLoading:O.value,form:f,onConfirm:oe},{default:a(()=>[l(E,{cols:"1"},{default:a(()=>[l(r,null,{default:a(()=>[l(n,{isRequired:!0,label:"Role",form:f,formKey:"role",options:m(N)},null,8,["form","options"])]),_:1}),f.role!=="super_admin"&&f.role!=="admin"?(g(),B(r,{key:0},{default:a(()=>[l(Q,{isRequired:!0,label:"LOB",form:f,formKey:"lob",options:v.value,onShow:D},null,8,["form","options"])]),_:1})):w("",!0)]),_:1})]),_:1},8,["isLoading","form"])])}}});const ye=_e(pe,[["__scopeId","data-v-5262ffa7"]]);export{ye as default};
