import{d as O,m as H,p as M,r as s,q as p,f as B,x as b,j as a,o as Q,c as V,a as E,A as y,i as D,R as oe,y as o,z as d,T as se,G as ne,H as ae,_ as W,l as ie,U as le}from"./index.74f2624c.js";const ce=k=>(ne("data-v-c42e8cf4"),k=k(),ae(),k),re={class:"view"},ue={class:"head-info"},de=ce(()=>E("div",{class:"flex-space"},null,-1)),pe=O({__name:"items",setup(k,{expose:A}){const g=H(),L=M(),i=s({});p(()=>L.getUserInfo.team),p(()=>L.getUserInfo.role),p(()=>L.getUserInfo.lob),p(()=>L.getUserInfo.id),A({setup:async(l,e)=>{i.value=l,e==="Enclosure"&&(u.checkListId=l.checkListId_Enclosure),u.type=e,e=="Enclosure"&&(P.value=[{title:"SN",key:"sn",width:60},{title:"Main Process",key:"mainProcess",width:300},{title:"Sub Process",key:"subProcess",width:300},{title:"Area",key:"area",width:300},{title:"Check Items",key:"checkItems",width:400},{title:"Sampling Size",key:"samplingSize",width:400},{title:"Looking For",key:"lookingFor",width:800},{title:"DIS Score",key:"disScore",width:100},{title:"Skip",key:"skip",width:100,valueFormator:v=>v?"TRUE":"FALSE"}]),w()}});const C=[{value:0,label:"Enclosure"}],P=s([]),U={actions:[]};s({});const r=s(1),_=s(15),u=B({}),m=s({total:0,list:[]}),S=s(!0),w=async()=>{S.value=!0;try{const l=await b("/sip/get_check_list_items_page",{pageNum:r.value,pageSize:_.value,...u});m.value=l}finally{S.value=!1}},j=(l,e)=>{},F=async(l,e)=>{},f=async()=>{g.loading("Processing");const l=i.value.lob+"_"+i.value.site+"_"+i.value.productLine+"_"+i.value.project+"_"+i.value.part+".xlsx";await se("/sip/export_check_list_items",{checkListId:u.checkListId},l),g.destroyAll()};return(l,e)=>{const v=a("AAListButtonDownload"),R=a("AAPageList"),N=a("n-card");return Q(),V("div",re,[E("div",ue,[E("p",null,y(i.value.lob)+" / "+y(i.value.site)+" / "+y(i.value.productLine)+" / "+y(i.value.project)+" / "+y(i.value.part)+" / "+y(D(oe)(u.type,C)),1),de,o(v,{title:"Export",onClick:f})]),o(N,null,{default:d(()=>[o(R,{isLoading:S.value,pageNum:r.value,"onUpdate:pageNum":e[0]||(e[0]=x=>r.value=x),pageSize:_.value,"onUpdate:pageSize":e[1]||(e[1]=x=>_.value=x),columns:P.value,actions:U,dataSource:m.value,onAction:j,onChange:F,onReload:w},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const _e=W(pe,[["__scopeId","data-v-c42e8cf4"]]),me={class:"page"},fe=O({__name:"index",setup(k){const A=H();ie();const g=M();p(()=>g.getUserInfo.team),p(()=>g.getUserInfo.role),p(()=>g.getUserInfo.lob);const L=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(t,n)=>{if(n.part){const c=[];return n.checkListId_Enclosure&&c.push("Enclosure"),c.join(" | ")}else return`${n.checkListUploaded} / ${n.checkListTotal}`}}],i=t=>t.id,C={width:"260px",actions:[{title:"Preview Enclosure",type:"default",key:"previewEnclosure",isShow:t=>t.part!=null&&t.checkListId_Enclosure!=null},{title:"Upload",type:"info",key:"update"}],more:[]};s({});const P=s(1),U=s(15),r=B({}),_=s([]),u=s(!0),m=async()=>{u.value=!0;try{const t=await b("/sip/get_lines_tree",{pageNum:P.value,pageSize:U.value,...r});_.value=t}finally{u.value=!1}},S=(t,n)=>{t==="previewEnclosure"?X(n,"Enclosure"):t==="update"?N(n):t==="delete"&&G(n)},w=s(null),j=()=>{w.value.show()},F=t=>{function n(h){var T=h.lastIndexOf("/"),z=h.lastIndexOf("\\"),I=Math.max(T,z);return I<0?h:h.substring(I+1)}const c=document.createElement("a");c.download=n(t),c.style.display="none",c.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+t,document.body.appendChild(c),c.click(),document.body.removeChild(c)},f=s(null),l=s(!1),e=B({}),v=p(()=>e.lob&&e.site&&e.productLine&&e.project&&e.part?`${e.lob}_${e.site}_${e.productLine}_${e.project}_${e.part}`:null),R=async()=>{e.lob=r.lob,e.site=r.site,e.productLine=r.productLine,e.project=r.project,e.part=r.part,e.type="Enclosure",f.value.show()},N=t=>{e.auditType=t.auditType,e.lob=t.lob,e.site=t.site,e.productLine=t.productLine,e.project=t.project,e.part=t.part,e.type="Enclosure",f.value.show()},x=async()=>{l.value=!0;try{await b("/sip/upload_check_list",e),A.success("Uploaded"),f.value.close(),m()}finally{l.value=!1}},G=async t=>{A.loading("Deleting"),await b("/sip/delete_check_list",{id:t.id}),A.success("Deleted"),f.value.close(),m()},$=s(),q=s(),X=async(t,n)=>{$.value.show(),await le(),q.value.setup(t,n)};return(t,n)=>{const c=a("AAListButtonAdd"),h=a("AAListButtonDownload"),T=a("AAListHandlers"),z=a("AAPageList"),I=a("n-card"),J=a("AADialog"),Y=a("AAFormSiteProject"),K=a("n-grid-item"),Z=a("AAFormSelectJsonWithExcel"),ee=a("n-grid"),te=a("AAFormDialog");return Q(),V("div",me,[o(I,null,{default:d(()=>[o(T,null,{default:d(()=>[o(c,{title:"Upload",onClick:R}),o(h,{title:"Check List Templates",onClick:j})]),_:1}),o(z,{isPaged:!1,isLoading:u.value,columns:L,actions:C,dataSource:_.value,childrenKey:"sub",rowKey:i,onReady:m,onAction:S,onReload:m},null,8,["isLoading","dataSource"])]),_:1}),o(J,{ref_key:"templatesDialogRef",ref:w,title:"Check List Templates",width:"320px"},{default:d(()=>[E("div",{class:"download-link",onClick:n[0]||(n[0]=ve=>F("team_SIP/files/LOB_Site_ProductLine_Project_Part.xlsx"))},"Check List Template")]),_:1},512),o(te,{ref_key:"editDialogRef",ref:f,title:"Upload Check List",width:"400px",isLoading:l.value,form:e,onConfirm:x},{default:d(()=>[o(ee,{cols:"1"},{default:d(()=>[o(K,null,{default:d(()=>[o(Y,{isRequired:!0,selectParent:!1,label:"Site Project",form:e,team:"SIP",siteProjects:_.value},null,8,["form","siteProjects"])]),_:1}),o(K,null,{default:d(()=>[o(Z,{disabled:!e.part,isRequired:!0,label:"Spec Excel/JSON File",form:e,formKey:"rawJson",validateName:D(v),tips:"The file must match the line selected"+(D(v)?", and with name '"+D(v)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),o(J,{ref_key:"previewDialogRef",ref:$,title:"Check List"},{default:d(()=>[o(_e,{ref_key:"previewRef",ref:q},null,512)]),_:1},512)])}}});const Le=W(fe,[["__scopeId","data-v-6670bb84"]]);export{Le as default};
