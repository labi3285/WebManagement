import{d as ve,m as pe,p as be,r as i,q as y,f as P,j as d,o as L,c as ge,y as a,z as s,i as c,k,B as M,x as r,U,_ as Ae}from"./index.18bbd02b.js";const ye={class:"page"},Le=ve({__name:"users-edit",setup(Re){const v=pe(),R=be(),x=[{value:"MQA",label:"MQA"},{value:"Accessory",label:"Accessory"},{value:"Display",label:"Display"},{value:"SIP",label:"SIP"},{value:"MDE",label:"MDE"}],N=[{value:"admin",label:"Admin"},{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}],p=i([]),w=i(""),Q=i(!1);async function J(){if(w.value!==n.team){p.value=[],Q.value=!0;try{if(o.value==="super_admin"){const e=n.team||"MQA";let l=[];e==="MQA"?l=await r("/get_level_lines",{}):l=await r("/"+e.toLowerCase()+"/get_level_lines",{}),p.value=l.map(t=>t.lob),w.value=e}else if(o.value==="admin"){const e=S.value;let l=[];e==="MQA"?l=await r("/get_level_lines",{}):l=await r("/"+e.toLowerCase()+"/get_level_lines",{}),p.value=l.map(t=>t.lob),w.value=e}else p.value=b.value||[],w.value=""}finally{Q.value=!1}}}const S=y(()=>R.getUserInfo.team),o=y(()=>R.getUserInfo.role),b=y(()=>R.getUserInfo.lob),q=e=>{if(b.value){for(const l of b.value)for(const t of e)if(l===t)return!0}return!1},W=y(()=>R.getUserInfo.id),X=[{title:"Account",key:"account",width:200},{title:"Team",key:"team",width:200,isShow:()=>o.value==="super_admin"},{title:"Role",key:"role",width:100,tagOptions:{valueLabels:N,valueTypes:[{value:"admin",type:"error"},{value:"lob_dri",type:"warning"},{value:"lob_auditor",type:"info"}]}},{title:"LOB",key:"lob",width:400,valueFormator:e=>e?e.join(","):""},{title:"Enabled",key:"status",width:80,switch:{isNumber:!0,isDisabled:e=>o.value==="admin"&&e.role==="admin"||o.value==="lob_dri"&&(e.role==="lob_dri"||e.role==="admin")||e.id===W.value}},{title:"Create Time",key:"createTime",width:200}],Y={width:"230px",actions:[{title:"Change Role",type:"warning",key:"role",isShow:e=>o.value==="super_admin"||o.value==="admin"&&e.role!=="super_admin"&&e.role!=="admin"||o.value==="lob_dri"&&e.role==="lob_auditor"&&q(e.lob)}],more:[{title:"Reset Password",type:"error",key:"reset_password",confirm:{targetKey:"account"},isShow:e=>o.value==="super_admin"||o.value==="admin"&&e.role!=="super_admin"&&e.role!=="admin"||o.value==="lob_dri"&&e.role==="lob_auditor"&&q(e.lob)}]},Z=i({}),h=i(1),E=i(15),n=P({});o.value==="super_admin"?n.team="MQA":n.team=S.value;const z=i({total:0,list:[]}),B=i(!0),ee=()=>{o.value==="super_admin"?n.team="MQA":n.team=S.value,n.account=null,n.role=null,n.lob=null,h.value=1},f=async()=>{B.value=!0;try{const e=await r("/get_users_page",{pageNum:h.value,pageSize:E.value,...n});z.value=e}finally{B.value=!1}},le=(e,l)=>{e==="role"?ie(l):e==="reset_password"?se(l):e==="delete"&&ne(l)},ae=async(e,l)=>{if(e==="status"){const t=l[e];try{await r("/update_user_status",{id:l.id,status:t})}catch{l[e]=t===1?0:1}}},g=i(null),I=i(!1),A=i([]),D=i(""),C=i(!1),u=P({});async function j(){if(D.value!==u.team){C.value=!0;try{if(o.value==="super_admin"){const e=u.team||"MQA";let l=[];e==="MQA"?l=await r("/get_level_lines",{}):l=await r("/"+e.toLowerCase()+"/get_level_lines",{}),A.value=l.map(t=>t.lob),D.value=e}else if(o.value==="admin"){const e=S.value;let l=[];e==="MQA"?l=await r("/get_level_lines",{}):l=await r("/"+e.toLowerCase()+"/get_level_lines",{}),A.value=l.map(t=>t.lob),D.value=e}else A.value=b.value||[],D.value=""}finally{C.value=!1}}}const H=y(()=>{if(o.value==="super_admin")return[{value:"admin",label:"Admin"},{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}];if(o.value==="admin")return[{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}];if(o.value==="lob_dri")return[{value:"lob_auditor",label:"LOB Auditor"}]}),oe=async e=>{e?U(u,e):o.value==="lob_dri"?(u.role="lob_auditor",u.lob=b.value):U(u,null),u.team=n.team,g.value.show()},te=async()=>{I.value=!0;try{await r("/add_user",u),v.success("Add Success"),g.value.close(),f()}finally{I.value=!1}},se=async e=>{v.loading("Reseting"),await r("/reset_user_password",{id:e.id}),v.success("Password Resetted"),g.value.close(),f()},ne=async e=>{v.loading("Deleting"),await r("/delete_user",{id:e.id}),v.success("Deleted"),g.value.close(),f()};i([]);const O=i(!1),T=i(null),_=P({});async function ie(e){U(_,{id:e.id,role:e.role,lob:e.lob}),T.value.show()}async function ue(){O.value=!0;try{await r("/change_user_role",_),v.success("Edit Success"),T.value.close(),f()}finally{O.value=!1}}return(e,l)=>{const t=d("AAFormSelect"),m=d("n-grid-item"),V=d("AAFormInputText"),re=d("AAFormQueryButtons"),K=d("n-grid"),de=d("AAForm"),me=d("AAListButtonAdd"),ce=d("AAListHandlers"),fe=d("AAPageList"),_e=d("n-card"),$=d("AAFormSelectMultiple"),G=d("AAFormDialog");return L(),ge("div",ye,[a(_e,null,{default:s(()=>[a(de,{labelPlacement:"left",isLoading:B.value,form:n,rules:Z.value},{default:s(()=>[a(K,{cols:"1 400:2 800:3 1000:4"},{default:s(()=>[c(o)==="super_admin"?(L(),k(m,{key:0},{default:s(()=>[a(t,{label:"Team",form:n,formKey:"team",options:x},null,8,["form"])]),_:1})):M("",!0),a(m,null,{default:s(()=>[a(V,{label:"Account",form:n,formKey:"account"},null,8,["form"])]),_:1}),a(m,null,{default:s(()=>[a(t,{label:"Role",form:n,formKey:"role",options:N},null,8,["form"])]),_:1}),a(m,null,{default:s(()=>[a(t,{label:"LOB",form:n,formKey:"lob",options:p.value,loading:Q.value,onShow:J},null,8,["form","options","loading"])]),_:1}),a(m,null,{default:s(()=>[a(re,{onQuery:f,onReset:ee})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"]),a(ce,null,{default:s(()=>[a(me,{title:c(o)==="lob_dri"?"Add Auditor":"Add User",onClick:l[0]||(l[0]=F=>oe(null))},null,8,["title"])]),_:1}),a(fe,{isLoading:B.value,pageNum:h.value,"onUpdate:pageNum":l[1]||(l[1]=F=>h.value=F),pageSize:E.value,"onUpdate:pageSize":l[2]||(l[2]=F=>E.value=F),columns:X,actions:Y,dataSource:z.value,onReady:f,onAction:le,onChange:ae,onReload:f},null,8,["isLoading","pageNum","pageSize","dataSource"])]),_:1}),a(G,{ref_key:"editDialogRef",ref:g,what:c(o)==="lob_dri"?"Auditor":"User",isLoading:I.value,form:u,onConfirm:te},{default:s(()=>[a(K,{cols:"1"},{default:s(()=>[c(o)==="super_admin"?(L(),k(m,{key:0},{default:s(()=>[a(t,{isRequired:!0,label:"Team",form:u,formKey:"team",options:x},null,8,["form"])]),_:1})):M("",!0),a(m,null,{default:s(()=>[a(V,{isRequired:!0,label:"Account",form:u,formKey:"account"},null,8,["form"])]),_:1}),a(m,null,{default:s(()=>[a(t,{disabled:c(o)!=="super_admin"&&c(o)!=="admin",isRequired:!0,label:"Role",form:u,formKey:"role",options:c(H)},null,8,["disabled","form","options"])]),_:1}),u.role!=="admin"?(L(),k(m,{key:1},{default:s(()=>[a($,{disabled:c(o)!=="super_admin"&&c(o)!=="admin",isRequired:!0,label:"LOB",form:u,formKey:"lob",loading:C.value,onShow:j,options:A.value},null,8,["disabled","form","loading","options"])]),_:1})):M("",!0)]),_:1})]),_:1},8,["what","isLoading","form"]),a(G,{ref_key:"editRoleDialogRef",ref:T,title:"Change Role",isLoading:O.value,form:_,onConfirm:ue},{default:s(()=>[a(K,{cols:"1"},{default:s(()=>[a(m,null,{default:s(()=>[a(t,{isRequired:!0,label:"Role",form:_,formKey:"role",options:c(H)},null,8,["form","options"])]),_:1}),_.role!=="super_admin"&&_.role!=="admin"?(L(),k(m,{key:0},{default:s(()=>[a($,{isRequired:!0,label:"LOB",form:_,formKey:"lob",options:A.value,loading:C.value,onShow:j},null,8,["form","options","loading"])]),_:1})):M("",!0)]),_:1})]),_:1},8,["isLoading","form"])])}}});const Se=Ae(Le,[["__scopeId","data-v-887fe03f"]]);export{Se as default};
