import{d as se,m as ne,p as ie,r as u,q as E,f as K,j as r,o as y,c as ue,y as o,z as t,i as c,k as w,B as h,x as f,U as q,_ as re}from"./index.13672014.js";const de={class:"page"},ce=se({__name:"users-edit",setup(me){const p=ne(),S=ie(),P=[{value:"mqa",label:"MQA"},{value:"accessory",label:"Accessory"},{value:"display",label:"Display"}],g=[{value:"admin",label:"Admin"},{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}],b=u([]);async function N(){const e=await f("/get_level_lines",{team:d.team});b.value=e.map(a=>a.lob)}const l=E(()=>S.getUserInfo.role),T=E(()=>S.getUserInfo.lob),O=E(()=>S.getUserInfo.id),z=[{title:"Account",key:"account",width:150},{title:"Team",key:"team",width:120,isShow:()=>l.value==="super_admin"},{title:"Role",key:"role",width:100,tagOptions:{valueLabels:g,valueTypes:[{value:"admin",type:"error"},{value:"lob_dri",type:"warning"},{value:"lob_auditor",type:"info"}]}},{title:"LOB",key:"lob",width:100},{title:"Enable",key:"status",width:80,switch:{isNumber:!0,isDisabled:e=>l.value!=="super_admin"&&l.value!=="admin"&&(l.value!=="lob_dri"||e.id===O.value)}},{title:"Create Time",key:"createTime",width:200}],Q={actions:[{title:"Change Role",type:"warning",key:"role",isShow:e=>l.value==="super_admin"||l.value==="admin"}],more:[{title:"Reset Password",type:"error",key:"reset_password",confirm:{targetKey:"account"},isShow:e=>l.value==="super_admin"||l.value==="admin"||l.value==="lob_dri"&&e.role!=="super_admin"&&e.role!=="admin"&&e.role!="lob_dri"&&e.lob===T.value}]},H=u({}),A=u(1),k=u(15),d=K({team:"mqa"}),U=u({total:0,list:[]}),R=u(!0),M=()=>{d.team="mqa",d.account=null,A.value=1},m=async()=>{R.value=!0;try{const e=await f("/get_users_page",{pageNum:A.value,pageSize:k.value,...d});U.value=e}finally{R.value=!1}},V=(e,a)=>{e==="role"?X(a):e==="reset_password"?J(a):e==="delete"&&W(a)},j=async(e,a)=>{if(e==="status"){const n=a[e];try{await f("/update_user_status",{id:a.id,status:n})}catch{a[e]=n===1?0:1}}},v=u(null),B=u(!1),s=K({}),$=async e=>{e?q(s,e):l.value==="lob_dri"?(s.role="lob_auditor",s.lob=T.value):q(s,null),s.team=d.team,v.value.show()},G=async()=>{B.value=!0;try{await f("/add_user",s),p.success("Add Success"),v.value.close(),m()}finally{B.value=!1}},J=async e=>{p.loading("Reseting"),await f("/reset_user_password",{id:e.id}),p.success("Password Resetted"),v.value.close(),m()},W=async e=>{p.loading("Deleting"),await f("/delete_user",{id:e.id}),p.success("Deleted"),v.value.close(),m()};u([]);const D=u(!1),C=u(null),_=K({});async function X(e){q(_,{id:e.id,role:e.role,lob:e.lob}),C.value.show()}async function Y(){D.value=!0;try{await f("/change_user_role",_),p.success("Edit Success"),C.value.close(),m()}finally{D.value=!1}}return(e,a)=>{const n=r("AAFormSelect"),i=r("n-grid-item"),x=r("AAFormInputText"),Z=r("AAFormQueryButtons"),F=r("n-grid"),ee=r("AAForm"),oe=r("AAListButtonAdd"),te=r("AAListHandlers"),le=r("AAPageList"),ae=r("n-card"),I=r("AAFormDialog");return y(),ue("div",de,[o(ae,null,{default:t(()=>[o(ee,{labelPlacement:"left",isLoading:R.value,form:d,rules:H.value},{default:t(()=>[o(F,{cols:"1 400:2 800:3 1000:4"},{default:t(()=>[c(l)==="super_admin"?(y(),w(i,{key:0},{default:t(()=>[o(n,{label:"Team",form:d,formKey:"team",options:P},null,8,["form"])]),_:1})):h("",!0),o(i,null,{default:t(()=>[o(x,{label:"Account",form:d,formKey:"account"},null,8,["form"])]),_:1}),o(i,null,{default:t(()=>[o(n,{label:"Role",form:d,formKey:"role",options:g,show:N},null,8,["form"])]),_:1}),o(i,null,{default:t(()=>[o(n,{label:"LOB",form:d,formKey:"lob",options:b.value},null,8,["form","options"])]),_:1}),o(i,null,{default:t(()=>[o(Z,{onQuery:m,onReset:M})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"]),o(te,null,{default:t(()=>[o(oe,{title:c(l)==="lob_dri"?"Add Auditor":"Add User",onClick:a[0]||(a[0]=L=>$(null))},null,8,["title"])]),_:1}),o(le,{isLoading:R.value,pageNum:A.value,"onUpdate:pageNum":a[1]||(a[1]=L=>A.value=L),pageSize:k.value,"onUpdate:pageSize":a[2]||(a[2]=L=>k.value=L),columns:z,actions:Q,dataSource:U.value,onReady:m,onAction:V,onChange:j,onReload:m},null,8,["isLoading","pageNum","pageSize","dataSource"])]),_:1}),o(I,{ref_key:"editDialogRef",ref:v,what:c(l)==="lob_dri"?"Auditor":"User",isLoading:B.value,form:s,onConfirm:G},{default:t(()=>[o(F,{cols:"1"},{default:t(()=>[c(l)==="super_admin"?(y(),w(i,{key:0},{default:t(()=>[o(n,{isRequired:!0,label:"Team",form:s,formKey:"team",options:P},null,8,["form"])]),_:1})):h("",!0),o(i,null,{default:t(()=>[o(x,{isRequired:!0,label:"Account",form:s,formKey:"account"},null,8,["form"])]),_:1}),o(i,null,{default:t(()=>[o(n,{disabled:c(l)!=="super_admin"&&c(l)!=="admin",isRequired:!0,label:"Role",form:s,formKey:"role",options:g},null,8,["disabled","form"])]),_:1}),s.role!=="admin"?(y(),w(i,{key:1},{default:t(()=>[o(n,{disabled:c(l)!=="super_admin"&&c(l)!=="admin",isRequired:!0,label:"LOB",form:s,formKey:"lob",options:b.value},null,8,["disabled","form","options"])]),_:1})):h("",!0)]),_:1})]),_:1},8,["what","isLoading","form"]),o(I,{ref_key:"editRoleDialogRef",ref:C,title:"Change Role",isLoading:D.value,form:_,onConfirm:Y},{default:t(()=>[o(F,{cols:"1"},{default:t(()=>[o(i,null,{default:t(()=>[o(n,{isRequired:!0,label:"Role",form:_,formKey:"role",options:g},null,8,["form"])]),_:1}),_.role!=="super_admin"&&_.role!=="admin"?(y(),w(i,{key:0},{default:t(()=>[o(n,{isRequired:!0,label:"LOB",form:_,formKey:"lob",options:b.value},null,8,["form","options"])]),_:1})):h("",!0)]),_:1})]),_:1},8,["isLoading","form"])])}}});const fe=re(ce,[["__scopeId","data-v-7f7da3b3"]]);export{fe as default};
