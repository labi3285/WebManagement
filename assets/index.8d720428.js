import{d as E,m as O,p as q,r as i,q as _,f as T,x,j as n,o as J,c as K,a as P,A as S,y as o,z as d,_ as H,l as ie,i as R,T as oe}from"./index.7c46848d.js";const le={class:"view"},ae={class:"head-info"},ne=E({__name:"items",setup(M,{expose:y}){O();const u=q(),p=i({});_(()=>u.getUserInfo.team),_(()=>u.getUserInfo.role),_(()=>u.getUserInfo.lob),_(()=>u.getUserInfo.id),y({setup:async(r,l)=>{p.value=r,l==="Glue"?a.checkListId=r.checkListId_Glue:l==="Destructive"&&(a.checkListId=r.checkListId_Destructive),a.type=l,l=="Glue"?g.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]:l=="Destructive"&&(g.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]),f()}});const g=i([]),I={actions:[]};i({});const k=i(1),A=i(15),a=T({}),L=i({total:0,list:[]}),m=i(!0),f=async()=>{m.value=!0;try{const r=await x("/accessory/get_check_list_items_page",{pageNum:k.value,pageSize:A.value,...a});L.value=r}finally{m.value=!1}},j=(r,l)=>{},D=async(r,l)=>{};return(r,l)=>{const v=n("AAPageList"),w=n("n-card");return J(),K("div",le,[P("div",ae,[P("p",null,S(p.value.lob)+" / "+S(p.value.site)+" / "+S(p.value.productLine)+" / "+S(p.value.project)+" / "+S(p.value.part),1)]),o(w,null,{default:d(()=>[o(v,{isLoading:m.value,pageNum:k.value,"onUpdate:pageNum":l[0]||(l[0]=e=>k.value=e),pageSize:A.value,"onUpdate:pageSize":l[1]||(l[1]=e=>A.value=e),columns:g.value,actions:I,dataSource:L.value,onAction:j,onChange:D,onReload:f},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const ce=H(ne,[["__scopeId","data-v-f7879a9e"]]),re={class:"page"},de=E({__name:"index",setup(M){const y=O();ie();const u=q();_(()=>u.getUserInfo.team),_(()=>u.getUserInfo.role),_(()=>u.getUserInfo.lob);const p=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(t,s)=>{if(s.part){const c=[];return s.checkListId_Glue&&c.push("Glue"),s.checkListId_Destructive&&c.push("Destructive"),c.join(" | ")}else return`${s.checkListUploaded} / ${s.checkListTotal}`}}],g=t=>t.id,I={width:"260px",actions:[{title:"Preview Glue",type:"default",key:"previewGlue",isShow:t=>t.part!=null&&t.checkListId_Glue!=null},{title:"Preview Destructive",type:"default",key:"previewDestructive",isShow:t=>t.part!=null&&t.checkListId_Destructive!=null},{title:"Upload",type:"info",key:"update"}],more:[]};i({});const k=i(1),A=i(15),a=T({}),L=i([]),m=i(!0),f=async()=>{m.value=!0;try{const t=await x("/accessory/get_lines_tree",{pageNum:k.value,pageSize:A.value,...a});L.value=t}finally{m.value=!1}},j=(t,s)=>{t==="previewGlue"?$(s,"Glue"):t==="previewDestructive"?$(s,"Destructive"):t==="update"?V(s):t==="delete"&&X(s)},D=i(null),r=()=>{D.value.show()},l=t=>{function s(h){var b=h.lastIndexOf("/"),N=h.lastIndexOf("\\"),C=Math.max(b,N);return C<0?h:h.substring(C+1)}const c=document.createElement("a");c.download=s(t),c.style.display="none",c.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+t,document.body.appendChild(c),c.click(),document.body.removeChild(c)},v=i(null),w=i(!1),e=T({}),U=_(()=>e.lob&&e.site&&e.productLine&&e.project&&e.part?`${e.lob}_${e.site}_${e.productLine}_${e.project}_${e.part}`:null),Q=async()=>{e.lob=a.lob,e.site=a.site,e.productLine=a.productLine,e.project=a.project,e.part=a.part,a.project?e.type=a.project:e.type=null,v.value.show()},V=t=>{e.auditType=t.auditType,e.lob=t.lob,e.site=t.site,e.productLine=t.productLine,e.project=t.project,e.part=t.part,e.type=t.project,v.value.show()},W=async()=>{w.value=!0;try{await x("/accessory/upload_check_list",e),y.success("Uploaded"),v.value.close(),f()}finally{w.value=!1}},X=async t=>{y.loading("Deleting"),await x("/accessory/delete_check_list",{id:t.id}),y.success("Deleted"),v.value.close(),f()},F=i(),G=i(),$=async(t,s)=>{F.value.show(),await oe(),G.value.setup(t,s)};return(t,s)=>{const c=n("AAListButtonAdd"),h=n("AAListButtonDownload"),b=n("AAListHandlers"),N=n("AAPageList"),C=n("n-card"),B=n("AADialog"),Y=n("AAFormSiteProject"),z=n("n-grid-item"),Z=n("AAFormSelectJsonWithExcel"),ee=n("n-grid"),te=n("AAFormDialog");return J(),K("div",re,[o(C,null,{default:d(()=>[o(b,null,{default:d(()=>[o(c,{title:"Upload",onClick:Q}),o(h,{title:"Check List Templates",onClick:r})]),_:1}),o(N,{isPaged:!1,isLoading:m.value,columns:p,actions:I,dataSource:L.value,childrenKey:"sub",rowKey:g,onReady:f,onAction:j,onReload:f},null,8,["isLoading","dataSource"])]),_:1}),o(B,{ref_key:"templatesDialogRef",ref:D,title:"Check List Templates",width:"320px"},{default:d(()=>[P("div",{class:"download-link",onClick:s[0]||(s[0]=se=>l("team_Accessory/files/LOB_Site_ProductLine_Glue_Line.xlsx"))},"Glue Check List Template"),P("div",{class:"download-link",onClick:s[1]||(s[1]=se=>l("team_Accessory/files/LOB_Site_ProductLine_Destructive_Line.xlsx"))},"Destructive Check List Template")]),_:1},512),o(te,{ref_key:"editDialogRef",ref:v,title:"Upload Check List",width:"400px",isLoading:w.value,form:e,onConfirm:W},{default:d(()=>[o(ee,{cols:"1"},{default:d(()=>[o(z,null,{default:d(()=>[o(Y,{isRequired:!0,selectParent:!1,label:"Site Project",form:e,team:"Accessory",siteProjects:L.value},null,8,["form","siteProjects"])]),_:1}),o(z,null,{default:d(()=>[o(Z,{disabled:!e.part,isRequired:!0,label:"Spec Excel/JSON File",form:e,formKey:"rawJson",validateName:R(U),tips:"The file must match the line selected"+(R(U)?", and with name '"+R(U)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),o(B,{ref_key:"previewDialogRef",ref:F,title:"Check List"},{default:d(()=>[o(ce,{ref_key:"previewRef",ref:G},null,512)]),_:1},512)])}}});const pe=H(de,[["__scopeId","data-v-1a2fea43"]]);export{pe as default};
