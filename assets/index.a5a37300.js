import{d as q,m as E,p as K,r as i,q as _,f as F,x as I,j as l,o as O,c as H,a as P,A as D,y as o,z as d,_ as M,l as oe,i as R,T as ae}from"./index.0ee12fe1.js";const le={class:"view"},ne={class:"head-info"},ce=q({__name:"items",setup(Q,{expose:k}){E();const p=K(),u=i({});_(()=>p.getUserInfo.team),_(()=>p.getUserInfo.role),_(()=>p.getUserInfo.lob),_(()=>p.getUserInfo.id),k({setup:async(r,a)=>{u.value=r,a==="Glue"?y.checkListId=r.checkListId_Glue:a==="Destructive"&&(y.checkListId=r.checkListId_Destructive),y.type=a,a=="Glue"?A.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]:a=="Destructive"&&(A.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]),h()}});const A=i([]),U={actions:[]};i({});const w=i(1),S=i(15),y=F({}),c=i({total:0,list:[]}),m=i(!0),h=async()=>{m.value=!0;try{const r=await I("/accessory/get_check_list_items_page",{pageNum:w.value,pageSize:S.value,...y});c.value=r}finally{m.value=!1}},L=(r,a)=>{},b=async(r,a)=>{};return(r,a)=>{const C=l("AAPageList"),v=l("n-card");return O(),H("div",le,[P("div",ne,[P("p",null,D(u.value.lob)+" / "+D(u.value.site)+" / "+D(u.value.productLine)+" / "+D(u.value.project)+" / "+D(u.value.part),1)]),o(v,null,{default:d(()=>[o(C,{isLoading:m.value,pageNum:w.value,"onUpdate:pageNum":a[0]||(a[0]=f=>w.value=f),pageSize:S.value,"onUpdate:pageSize":a[1]||(a[1]=f=>S.value=f),columns:A.value,actions:U,dataSource:c.value,onAction:L,onChange:b,onReload:h},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const re=M(ce,[["__scopeId","data-v-f7879a9e"]]),ue={class:"page"},de=q({__name:"index",setup(Q){const k=E();oe();const p=K();_(()=>p.getUserInfo.team);const u=_(()=>p.getUserInfo.role);_(()=>p.getUserInfo.lob);const A=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(e,s)=>{if(s.part){const n=[];return s.checkListId_Glue&&n.push("Glue"),s.checkListId_Destructive&&n.push("Destructive"),n.join(" | ")}else return`${s.checkListUploaded} / ${s.checkListTotal}`}}],U=e=>e.id,w={width:"260px",actions:[{title:"Preview Glue",type:"default",key:"previewGlue",isShow:e=>e.part!=null&&e.checkListId_Glue!=null},{title:"Preview Destructive",type:"default",key:"previewDestructive",isShow:e=>e.part!=null&&e.checkListId_Destructive!=null},{title:"Upload",type:"info",key:"update",isShow:e=>u.value==="super_admin"||u.value==="admin"||u.value==="lob_dri"}],more:[]};i({});const S=i(1),y=i(15),c=F({}),m=i([]),h=i(!0),L=async()=>{h.value=!0;try{const e=await I("/accessory/get_lines_tree",{pageNum:S.value,pageSize:y.value,...c});m.value=e}finally{h.value=!1}},b=(e,s)=>{e==="previewGlue"?z(s,"Glue"):e==="previewDestructive"?z(s,"Destructive"):e==="update"?W(s):e==="delete"&&Y(s)},r=i(null),a=()=>{r.value.show()},C=e=>{function s(g){var N=g.lastIndexOf("/"),T=g.lastIndexOf("\\"),j=Math.max(N,T);return j<0?g:g.substring(j+1)}const n=document.createElement("a");n.download=s(e),n.style.display="none",n.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+e,document.body.appendChild(n),n.click(),document.body.removeChild(n)},v=i(null),f=i(!1),t=F({}),x=_(()=>t.lob&&t.site&&t.productLine&&t.project&&t.part?`${t.lob}_${t.site}_${t.productLine}_${t.project}_${t.part}.json`:null),V=async()=>{t.lob=c.lob,t.site=c.site,t.productLine=c.productLine,t.project=c.project,t.part=c.part,c.project?t.type=c.project:t.type=null,v.value.show()},W=e=>{t.auditType=e.auditType,t.lob=e.lob,t.site=e.site,t.productLine=e.productLine,t.project=e.project,t.part=e.part,t.type=e.project,v.value.show()},X=async()=>{f.value=!0;try{await I("/accessory/upload_check_list",t),k.success("Uploaded"),v.value.close(),L()}finally{f.value=!1}},Y=async e=>{k.loading("Deleting"),await I("/accessory/delete_check_list",{id:e.id}),k.success("Deleted"),v.value.close(),L()},G=i(),$=i(),z=async(e,s)=>{G.value.show(),await ae(),$.value.setup(e,s)};return(e,s)=>{const n=l("AAListButtonAdd"),g=l("AAListButtonDownload"),N=l("AAListHandlers"),T=l("AAPageList"),j=l("n-card"),B=l("AADialog"),Z=l("AAFormSiteProject"),J=l("n-grid-item"),ee=l("AAFormSelectJson"),te=l("n-grid"),se=l("AAFormDialog");return O(),H("div",ue,[o(j,null,{default:d(()=>[o(N,null,{default:d(()=>[o(n,{title:"Upload",onClick:V}),o(g,{title:"Check List Templates",onClick:a})]),_:1}),o(T,{isPaged:!1,isLoading:h.value,columns:A,actions:w,dataSource:m.value,childrenKey:"sub",rowKey:U,onReady:L,onAction:b,onReload:L},null,8,["isLoading","dataSource"])]),_:1}),o(B,{ref_key:"templatesDialogRef",ref:r,title:"Check List Templates",width:"320px"},{default:d(()=>[P("div",{class:"download-link",onClick:s[0]||(s[0]=ie=>C("team_Accessory/files/Check_List_Template_Glue.json"))},"Glue Check List Template"),P("div",{class:"download-link",onClick:s[1]||(s[1]=ie=>C("team_Accessory/files/Check_List_Template_Destructive.json"))},"Destructive Check List Template")]),_:1},512),o(se,{ref_key:"editDialogRef",ref:v,title:"Upload Check List",width:"400px",isLoading:f.value,form:t,onConfirm:X},{default:d(()=>[o(te,{cols:"1"},{default:d(()=>[o(J,null,{default:d(()=>[o(Z,{isRequired:!0,selectParent:!1,label:"Site Project",form:t,team:"Accessory",siteProjects:m.value},null,8,["form","siteProjects"])]),_:1}),o(J,null,{default:d(()=>[o(ee,{disabled:!t.part,isRequired:!0,label:"JSON Spec File",form:t,formKey:"rawJson",validateName:R(x),tips:"The JSON file must match the line selected"+(R(x)?", and with name '"+R(x)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),o(B,{ref_key:"previewDialogRef",ref:G,title:"Check List"},{default:d(()=>[o(re,{ref_key:"previewRef",ref:$},null,512)]),_:1},512)])}}});const _e=M(de,[["__scopeId","data-v-223365a8"]]);export{_e as default};
