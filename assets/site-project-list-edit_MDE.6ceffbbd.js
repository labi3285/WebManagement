import{d as Se,m as Pe,l as ke,p as Ce,q as E,r as t,f as G,j as u,o as v,c as De,y as s,z as i,i as c,k as j,B as A,x as h,_ as Ee}from"./index.1cc141c4.js";const Re={class:"page"},xe=Se({__name:"site-project-list-edit_MDE",setup(Be){const R=Pe();ke();const p=Ce(),J=[{value:"lob",label:"LOB"},{value:"site",label:"Site"},{value:"productLine",label:"Product Line"},{value:"project",label:"Project"},{value:"part",label:"Part/Color"}];E(()=>p.getUserInfo.team);const n=E(()=>p.getUserInfo.role),x=E(()=>p.getUserInfo.lob),W=e=>{if(x.value){for(const r of x.value)if(r===e)return!0}return!1},X=async()=>{const e=await h("/refresh_user",{});p.setToken(e.token),p.setUserInfo(e.user)},Y=[{title:"Site Project Tree",key:"name",align:"left",width:500}],Z=e=>e.id,ee=e=>!((n.value==="lob_dri"||n.value==="lob_auditor")&&(!e.site||!W(e.lob))),le={actions:[{title:"Add Sub",type:"info",key:"add_sub",isShow:e=>!e.part}],more:[{title:"Delete",type:"error",key:"delete",confirm:{type:"delete",targetName:e=>e.part?e.part:e.project?e.project:e.productLine?e.productLine:e.site?e.site:e.lob?e.lob:null,additionalText:" Delete line will delete sub lines together, and this action cannot be undone!"},isShow:e=>ee(e)}]};t({});const te=t(1),oe=t(15),o=G({}),S=async e=>await h("/mde/get_level_lines",e),b=t([]),B=t(!1),L=t(!1),ae=async()=>{if(!L.value){B.value=!0;try{b.value=(await S({})).map(e=>({value:e.lob,label:e.lob})),L.value=!0}finally{B.value=!1}}},T=()=>{(n.value==="super_admin"||n.value==="admin")&&(b.value=[],L.value=!1,o.lob=null),q.value=[],U.value=!1,o.site=null,M.value=[],z.value=!1,o.productLine=null,H.value=[],V.value=!1,o.project=null},ne=()=>{q.value=[],U.value=!1,o.site=null,M.value=[],z.value=!1,o.productLine=null,H.value=[],V.value=!1,o.project=null},q=t([]);t(!1);const U=t(!1),M=t([]);t(!1);const z=t(!1),H=t([]);t(!1);const V=t(!1),Q=t([]),K=t(!0),P=async()=>{K.value=!0;try{const e=await h("/mde/get_lines_tree",{pageNum:te.value,pageSize:oe.value,...o});Q.value=e}finally{K.value=!1}},se=(e,r)=>{e==="add_sub"?pe(r):e==="delete"&&Le(r)},m=t(null),F=t(!1),l=G({}),$=()=>{b.value=[],L.value=!1,l.lob=null,k.value=[],C.value=!1,l.site=null,_.value=[],g.value=!1,l.productLine=null,d.value=[],f.value=!1,l.project=null},ue=()=>{k.value=[],C.value=!1,l.site=null,_.value=[],g.value=!1,l.productLine=null,d.value=[],f.value=!1,l.project=null},k=t([]),I=t(!1),C=t(!1),ie=async()=>{if(!C.value){I.value=!0;try{k.value=(await S({lob:l.lob})).map(e=>({value:e.site,label:e.site})),C.value=!0}finally{I.value=!1}}},re=()=>{_.value=[],g.value=!1,l.productLine=null,d.value=[],f.value=!1,l.project=null},_=t([]),N=t(!1),g=t(!1),ce=async()=>{if(!g.value){N.value=!0;try{_.value=(await S({lob:l.lob,site:l.site})).map(e=>({value:e.productLine,label:e.productLine})),g.value=!0}finally{N.value=!1}}},de=()=>{d.value=[],f.value=!1,l.project=null},d=t([]),O=t(!1),f=t(!1),fe=async()=>{if(!f.value){O.value=!0;try{d.value=(await S({lob:l.lob,site:l.site,productLine:l.productLine})).map(e=>({value:e.project,label:e.project})),f.value=!0}finally{O.value=!1}}},w=E(()=>{for(const e of J)if(e.value===a.value)return e.label;return a.value}),a=t(""),ve=async e=>{a.value=e,e==="lob"?(l.lob=null,l.site=null,l.productLine=null,l.project=null):e==="site"?(l.lob=o.lob,l.site=null,l.productLine=null,l.project=null):e==="productLine"?(l.lob=o.lob,l.site=o.site,l.productLine=null,l.project=null):e==="project"?(l.lob=o.lob,l.site=o.site,l.productLine=o.productLine,l.project=null):(l.lob=o.lob,l.site=o.site,l.productLine=o.productLine,l.project=o.project),l.part=null,m.value.show()},pe=e=>{e.project?(a.value="part",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=e.project):e.productLine?(a.value="project",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=null):e.site?(a.value="productLine",l.lob=e.lob,l.site=e.site,l.productLine=null,l.project=null):e.lob&&(a.value="site",l.lob=e.lob,l.site=null,l.productLine=null,l.project=null),l.part=null,m.value.show()},be=async()=>{F.value=!0;try{await h("/mde/add_line",l),R.success("Add Success"),m.value.close(),P(),T(),$(),a.value==="lob"&&n.value==="lob_dri"&&X()}finally{F.value=!1}},Le=async e=>{R.loading("Deleting"),await h("/mde/delete_line",{id:e.id}),R.success("Deleted"),m.value.close(),P(),T(),$()};if(n.value!=="super_admin"&&n.value!=="admin"){const e=x.value||"";b.value=[{value:e,label:e}],L.value=!0,o.lob=e,ne()}return(e,r)=>{const me=u("AAListButtonAdd"),_e=u("AAListHandlers"),ge=u("AAPageList"),ye=u("n-card"),D=u("AAFormSelect"),y=u("n-grid-item"),je=u("AAFormInputText"),Ae=u("n-grid"),he=u("AAFormDialog");return v(),De("div",Re,[s(ye,null,{default:i(()=>[s(_e,null,{default:i(()=>[c(n)==="super_admin"||c(n)==="admin"||c(n)==="lob_dri"?(v(),j(me,{key:0,title:"Add LOB",onClick:r[0]||(r[0]=Ke=>ve("lob"))})):A("",!0)]),_:1}),s(ge,{isPaged:!1,isLoading:K.value,columns:Y,actions:le,dataSource:Q.value,childrenKey:"sub",rowKey:Z,onReady:P,onAction:se,onReload:P},null,8,["isLoading","dataSource"])]),_:1}),s(he,{ref_key:"editDialogRef",ref:m,what:c(w),isLoading:F.value,form:l,onConfirm:be},{default:i(()=>[s(Ae,{cols:"1"},{default:i(()=>[a.value!=="lob"?(v(),j(y,{key:0},{default:i(()=>[s(D,{disabled:c(n)!=="super_admin"&&c(n)!=="admin",isRequired:!0,label:"LOB",form:l,formKey:"lob",options:b.value,loading:B.value,onChange:ue,onShow:ae},null,8,["disabled","form","options","loading"])]),_:1})):A("",!0),a.value==="productLine"||a.value==="project"||a.value==="part"?(v(),j(y,{key:1},{default:i(()=>[s(D,{disabled:!l.lob,isRequired:!0,label:"Site",form:l,formKey:"site",options:k.value,loading:I.value,onChange:re,onShow:ie},null,8,["disabled","form","options","loading"])]),_:1})):A("",!0),a.value==="project"||a.value==="part"?(v(),j(y,{key:2},{default:i(()=>[s(D,{disabled:!l.site,isRequired:!0,label:"Product Line",form:l,formKey:"productLine",options:_.value,loading:N.value,onChange:de,onShow:ce},null,8,["disabled","form","options","loading"])]),_:1})):A("",!0),a.value==="part"?(v(),j(y,{key:3},{default:i(()=>[s(D,{disabled:!l.productLine,isRequired:!0,label:"Project",form:l,formKey:"project",options:d.value,loading:O.value,onShow:fe},null,8,["disabled","form","options","loading"])]),_:1})):A("",!0),s(y,null,{default:i(()=>[s(je,{isRequired:!0,label:c(w)+" Name",form:l,formKey:a.value},null,8,["label","form","formKey"])]),_:1})]),_:1})]),_:1},8,["what","isLoading","form"])])}}});const Ie=Ee(xe,[["__scopeId","data-v-c70b06a8"]]);export{Ie as default};
