import{d as B,m as q,p as J,r as o,q as p,f as R,x as D,j as a,o as K,c as M,a as T,A as C,y as s,z as r,_ as O,l as oe,i as N,T as se}from"./index.18bbd02b.js";const ne={class:"view"},ae={class:"head-info"},ie=B({__name:"items",setup(H,{expose:h}){q();const u=J(),_=o({});p(()=>u.getUserInfo.team),p(()=>u.getUserInfo.role),p(()=>u.getUserInfo.lob),p(()=>u.getUserInfo.id),h({setup:async(d,i)=>{_.value=d,i==="default"&&(c.checkListId=d.checkListId),c.type=i,i=="default"&&(w.value=[{title:"SN",key:"sn",width:60},{title:"Station",key:"station",width:200},{title:"Process",key:"process",width:400},{title:"Product line",key:"productLine",width:200},{title:"Project",key:"project",width:200},{title:"Check Item",key:"checkItem",width:400},{title:"USL",key:"USL",width:100},{title:"LSL",key:"LSL",width:100}]),f()}});const w=o([]),j={actions:[]};o({});const y=o(1),k=o(15),c=R({}),g=o({total:0,list:[]}),m=o(!0),f=async()=>{m.value=!0;try{const d=await D("/mde/get_check_list_items_page",{pageNum:y.value,pageSize:k.value,...c});g.value=d}finally{m.value=!1}},P=(d,i)=>{},S=async(d,i)=>{};return(d,i)=>{const v=a("AAPageList"),A=a("n-card");return K(),M("div",ne,[T("div",ae,[T("p",null,C(_.value.lob)+" / "+C(_.value.site)+" / "+C(_.value.productLine)+" / "+C(_.value.project),1)]),s(A,null,{default:r(()=>[s(v,{isLoading:m.value,pageNum:y.value,"onUpdate:pageNum":i[0]||(i[0]=e=>y.value=e),pageSize:k.value,"onUpdate:pageSize":i[1]||(i[1]=e=>k.value=e),columns:w.value,actions:j,dataSource:g.value,onAction:P,onChange:S,onReload:f},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const le=O(ie,[["__scopeId","data-v-590d7382"]]),ce={class:"page"},de=B({__name:"index",setup(H){const h=q();oe();const u=J();p(()=>u.getUserInfo.team),p(()=>u.getUserInfo.role),p(()=>u.getUserInfo.lob);const _=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(t,n)=>{if(n.project){const l=[];return n.checkListId&&l.push("Check List"),l.join(" | ")}else return`${n.checkListUploaded} / ${n.checkListTotal}`}}],w=t=>t.id,j={width:"260px",actions:[{title:"Preview",type:"default",key:"preview",isShow:t=>t.project!=null&&t.checkListId!=null},{title:"Upload",type:"info",key:"update",isShow:t=>!t.part}],more:[]};o({});const y=o(1),k=o(15),c=R({}),g=o([]),m=o(!0),f=async()=>{m.value=!0;try{const t=await D("/mde/get_lines_tree",{deepth:"project",pageNum:y.value,pageSize:k.value,...c});g.value=t}finally{m.value=!1}},P=(t,n)=>{t==="preview"?X(n,"default"):t==="update"?V(n):t==="delete"&&G(n)},S=o(null),d=()=>{S.value.show()},i=t=>{function n(L){var I=L.lastIndexOf("/"),U=L.lastIndexOf("\\"),b=Math.max(I,U);return b<0?L:L.substring(b+1)}const l=document.createElement("a");l.download=n(t),l.style.display="none",l.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+t,document.body.appendChild(l),l.click(),document.body.removeChild(l)},v=o(null),A=o(!1),e=R({}),x=p(()=>e.lob&&e.site&&e.productLine&&e.project?`${e.lob}_${e.site}_${e.productLine}_${e.project}`:null),Q=async()=>{e.lob=c.lob,e.site=c.site,e.productLine=c.productLine,e.project=c.project,e.type="default",v.value.show()},V=t=>{e.auditType=t.auditType,e.lob=t.lob,e.site=t.site,e.productLine=t.productLine,e.project=t.project,e.type="default",v.value.show()},W=async()=>{A.value=!0;try{await D("/mde/upload_check_list",e),h.success("Uploaded"),v.value.close(),f()}finally{A.value=!1}},G=async t=>{h.loading("Deleting"),await D("/mde/delete_check_list",{id:t.id}),h.success("Deleted"),v.value.close(),f()},F=o(),E=o(),X=async(t,n)=>{F.value.show(),await se(),E.value.setup(t,n)};return(t,n)=>{const l=a("AAListButtonAdd"),L=a("AAListButtonDownload"),I=a("AAListHandlers"),U=a("AAPageList"),b=a("n-card"),$=a("AADialog"),Y=a("AAFormSiteProjectNopart"),z=a("n-grid-item"),Z=a("AAFormSelectJsonWithExcel"),ee=a("n-grid"),te=a("AAFormDialog");return K(),M("div",ce,[s(b,null,{default:r(()=>[s(I,null,{default:r(()=>[s(l,{title:"Upload",onClick:Q}),s(L,{title:"Check List Templates",onClick:d})]),_:1}),s(U,{isPaged:!1,isLoading:m.value,columns:_,actions:j,dataSource:g.value,childrenKey:"sub",rowKey:w,onReady:f,onAction:P,onReload:f},null,8,["isLoading","dataSource"])]),_:1}),s($,{ref_key:"templatesDialogRef",ref:S,title:"Check List Templates",width:"320px"},{default:r(()=>[T("div",{class:"download-link",onClick:n[0]||(n[0]=re=>i("team_MDE/files/Check_List_Template.json"))},"Check List Template")]),_:1},512),s(te,{ref_key:"editDialogRef",ref:v,title:"Upload Check List",width:"400px",isLoading:A.value,form:e,onConfirm:W},{default:r(()=>[s(ee,{cols:"1"},{default:r(()=>[s(z,null,{default:r(()=>[s(Y,{isRequired:!0,selectParent:!1,label:"Site Project",form:e,team:"MDE",siteProjects:g.value},null,8,["form","siteProjects"])]),_:1}),s(z,null,{default:r(()=>[s(Z,{disabled:!e.project,isRequired:!0,label:"Spec Excel/JSON File",form:e,formKey:"rawJson",validateName:N(x),tips:"The file must match the line selected"+(N(x)?", and with name '"+N(x)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),s($,{ref_key:"previewDialogRef",ref:F,title:"Check List"},{default:r(()=>[s(le,{ref_key:"previewRef",ref:E},null,512)]),_:1},512)])}}});const pe=O(de,[["__scopeId","data-v-b68be40b"]]);export{pe as default};
