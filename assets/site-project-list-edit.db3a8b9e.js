import{d as Pe,m as ke,l as Ce,p as Re,q as R,r as t,f as W,j as i,o as b,c as Ee,y as n,z as u,i as d,k as A,B as h,R as De,x as S,_ as Ke}from"./index.b2114195.js";const xe={class:"page"},Be=Pe({__name:"site-project-list-edit",setup(Fe){const E=ke();Ce();const L=Re(),O=[{value:"1",label:"Module"},{value:"2",label:"Enclosure"},{value:"3",label:"AudioHome"}],X=[{value:"lob",label:"LOB"},{value:"site",label:"Site"},{value:"productLine",label:"Product Line"},{value:"project",label:"Project"},{value:"part",label:"Part/Color"}];R(()=>L.getUserInfo.team);const s=R(()=>L.getUserInfo.role),D=R(()=>L.getUserInfo.lob),Y=e=>{if(D.value){for(const r of D.value)if(r===e)return!0}return!1},Z=async()=>{const e=await S("/refresh_user",{});L.setToken(e.token),L.setUserInfo(e.user)},ee=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Audit Type",key:"auditType",width:200,valueFormator:e=>De(e,O)}],le=e=>e.id,te=e=>!((s.value==="lob_dri"||s.value==="lob_auditor")&&(!e.site||!Y(e.lob))),ae={actions:[{title:"Add Sub",type:"info",key:"add_sub",isShow:e=>!e.part}],more:[{title:"Delete",type:"error",key:"delete",confirm:{type:"delete",targetName:e=>e.part?e.part:e.project?e.project:e.productLine?e.productLine:e.site?e.site:e.lob?e.lob:null,additionalText:" Delete line will delete sub lines together, and this action cannot be undone!"},isShow:e=>te(e)}]};t({});const oe=t(1),ne=t(15),a=W({}),T=async e=>await S("/get_level_lines",e),c=t([]),K=t(!1),m=t(!1),se=async()=>{if(!m.value){K.value=!0;try{c.value=(await T({})).map(e=>({auditType:e.auditType,value:e.lob,label:e.lob})),m.value=!0}finally{K.value=!1}}},U=()=>{(s.value==="super_admin"||s.value==="admin")&&(c.value=[],m.value=!1,a.lob=null),z.value=[],H.value=!1,a.site=null,M.value=[],V.value=!1,a.productLine=null,Q.value=[],$.value=!1,a.project=null},ue=()=>{z.value=[],H.value=!1,a.site=null,M.value=[],V.value=!1,a.productLine=null,Q.value=[],$.value=!1,a.project=null},z=t([]);t(!1);const H=t(!1),M=t([]);t(!1);const V=t(!1),Q=t([]);t(!1);const $=t(!1),w=t([]),x=t(!0),P=async()=>{x.value=!0;try{const e=await S("/get_lines_tree",{pageNum:oe.value,pageSize:ne.value,...a});w.value=e}finally{x.value=!1}},ie=(e,r)=>{e==="add_sub"?Le(r):e==="delete"&&_e(r)},_=t(null),B=t(!1),l=W({}),G=()=>{c.value=[],m.value=!1,l.lob=null,k.value=[],C.value=!1,l.site=null,y.value=[],g.value=!1,l.productLine=null,p.value=[],f.value=!1,l.project=null},F=()=>{if(l.lob){for(const e of c.value)if(e.value===l.lob){l.auditType=e.auditType;break}}else l.auditType=null},re=()=>{k.value=[],C.value=!1,l.site=null,y.value=[],g.value=!1,l.productLine=null,p.value=[],f.value=!1,l.project=null,F()},k=t([]),I=t(!1),C=t(!1),de=async()=>{if(!C.value){I.value=!0;try{k.value=(await T({lob:l.lob})).map(e=>({auditType:e.auditType,value:e.site,label:e.site})),C.value=!0}finally{I.value=!1}}},ce=()=>{y.value=[],g.value=!1,l.productLine=null,p.value=[],f.value=!1,l.project=null},y=t([]),q=t(!1),g=t(!1),pe=async()=>{if(!g.value){q.value=!0;try{y.value=(await T({lob:l.lob,site:l.site})).map(e=>({auditType:e.auditType,value:e.productLine,label:e.productLine})),g.value=!0}finally{q.value=!1}}},fe=()=>{p.value=[],f.value=!1,l.project=null},p=t([]),N=t(!1),f=t(!1),ve=async()=>{if(!f.value){N.value=!0;try{p.value=(await T({lob:l.lob,site:l.site,productLine:l.productLine})).map(e=>({auditType:e.auditType,value:e.project,label:e.project})),f.value=!0}finally{N.value=!1}}},J=R(()=>{for(const e of X)if(e.value===o.value)return e.label;return o.value}),o=t(""),be=async e=>{o.value=e,l.auditType=null,e==="lob"?(l.lob=null,l.site=null,l.productLine=null,l.project=null):e==="site"?(l.lob=a.lob,l.site=null,l.productLine=null,l.project=null):e==="productLine"?(l.lob=a.lob,l.site=a.site,l.productLine=null,l.project=null):e==="project"?(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=null):(l.lob=a.lob,l.site=a.site,l.productLine=a.productLine,l.project=a.project),l.part=null,F(),_.value.show()},Le=e=>{l.auditType=e.auditType,e.project?(o.value="part",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=e.project):e.productLine?(o.value="project",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=null):e.site?(o.value="productLine",l.lob=e.lob,l.site=e.site,l.productLine=null,l.project=null):e.lob&&(o.value="site",l.lob=e.lob,l.site=null,l.productLine=null,l.project=null),l.part=null,F(),_.value.show()},me=async()=>{B.value=!0;try{await S("/add_line",l),E.success("Add Success"),_.value.close(),P(),U(),G(),o.value==="lob"&&s.value==="lob_dri"&&Z()}finally{B.value=!1}},_e=async e=>{E.loading("Deleting"),await S("/delete_line",{id:e.id}),E.success("Deleted"),_.value.close(),P(),U(),G()};if(s.value!=="super_admin"&&s.value!=="admin"){const e=D.value||"";c.value=[{value:e,label:e}],m.value=!0,a.lob=e,ue()}return(e,r)=>{const ye=i("AAListButtonAdd"),ge=i("AAListHandlers"),je=i("AAPageList"),Ae=i("n-card"),j=i("AAFormSelect"),v=i("n-grid-item"),he=i("AAFormInputText"),Se=i("n-grid"),Te=i("AAFormDialog");return b(),Ee("div",xe,[n(Ae,null,{default:u(()=>[n(ge,null,{default:u(()=>[d(s)==="super_admin"||d(s)==="admin"||d(s)==="lob_dri"?(b(),A(ye,{key:0,title:"Add LOB",onClick:r[0]||(r[0]=Ie=>be("lob"))})):h("",!0)]),_:1}),n(je,{isPaged:!1,isLoading:x.value,columns:ee,actions:ae,dataSource:w.value,childrenKey:"sub",rowKey:le,onReady:P,onAction:ie,onReload:P},null,8,["isLoading","dataSource"])]),_:1}),n(Te,{ref_key:"editDialogRef",ref:_,what:d(J),isLoading:B.value,form:l,onConfirm:me},{default:u(()=>[n(Se,{cols:"1"},{default:u(()=>[o.value!=="lob"?(b(),A(v,{key:0},{default:u(()=>[n(j,{disabled:d(s)!=="super_admin"&&d(s)!=="admin",isRequired:!0,label:"LOB",form:l,formKey:"lob",options:c.value,loading:K.value,onChange:re,onShow:se},null,8,["disabled","form","options","loading"])]),_:1})):h("",!0),o.value==="productLine"||o.value==="project"||o.value==="part"?(b(),A(v,{key:1},{default:u(()=>[n(j,{disabled:!l.lob,isRequired:!0,label:"Site",form:l,formKey:"site",options:k.value,loading:I.value,onChange:ce,onShow:de},null,8,["disabled","form","options","loading"])]),_:1})):h("",!0),o.value==="project"||o.value==="part"?(b(),A(v,{key:2},{default:u(()=>[n(j,{disabled:!l.site,isRequired:!0,label:"Product Line",form:l,formKey:"productLine",options:y.value,loading:q.value,onChange:fe,onShow:pe},null,8,["disabled","form","options","loading"])]),_:1})):h("",!0),o.value==="part"?(b(),A(v,{key:3},{default:u(()=>[n(j,{disabled:!l.productLine,isRequired:!0,label:"Project",form:l,formKey:"project",options:p.value,loading:N.value,onShow:ve},null,8,["disabled","form","options","loading"])]),_:1})):h("",!0),n(v,null,{default:u(()=>[n(he,{isRequired:!0,label:d(J)+" Name",form:l,formKey:o.value},null,8,["label","form","formKey"])]),_:1}),n(v,null,{default:u(()=>[n(j,{disabled:o.value!=="lob",isRequired:!0,label:"Audit Type",form:l,formKey:"auditType",options:O},null,8,["disabled","form"])]),_:1})]),_:1})]),_:1},8,["what","isLoading","form"])])}}});const Ne=Ke(Be,[["__scopeId","data-v-20960af1"]]);export{Ne as default};
