import{d as J,m as q,p as K,r as o,q as _,f as T,x as C,j as a,o as M,c as O,a as F,A as D,y as s,z as r,_ as H,l as se,i as R,T as ne}from"./index.6e099f2e.js";const ae={class:"view"},ie={class:"head-info"},le=J({__name:"items",setup(Q,{expose:h}){q();const u=K(),d=o({});_(()=>u.getUserInfo.team),_(()=>u.getUserInfo.role),_(()=>u.getUserInfo.lob),_(()=>u.getUserInfo.id),h({setup:async(c,i)=>{d.value=c,i==="default"&&(w.checkListId=c.checkListId),w.type=i,i=="default"&&(S.value=[{title:"SN",key:"sn",width:60},{title:"Station",key:"station",width:200},{title:"Process",key:"process",width:400},{title:"Product line",key:"productLine",width:200},{title:"Project",key:"project",width:200},{title:"Check Item",key:"checkItem",width:400},{title:"USL",key:"USL",width:100},{title:"LSL",key:"LSL",width:100}]),g()}});const S=o([]),P={actions:[]};o({});const A=o(1),k=o(15),w=T({}),p=o({total:0,list:[]}),m=o(!0),g=async()=>{m.value=!0;try{const c=await C("/mde/get_check_list_items_page",{pageNum:A.value,pageSize:k.value,...w});p.value=c}finally{m.value=!1}},L=(c,i)=>{},b=async(c,i)=>{};return(c,i)=>{const I=a("AAPageList"),f=a("n-card");return M(),O("div",ae,[F("div",ie,[F("p",null,D(d.value.lob)+" / "+D(d.value.site)+" / "+D(d.value.productLine)+" / "+D(d.value.project),1)]),s(f,null,{default:r(()=>[s(I,{isLoading:m.value,pageNum:A.value,"onUpdate:pageNum":i[0]||(i[0]=v=>A.value=v),pageSize:k.value,"onUpdate:pageSize":i[1]||(i[1]=v=>k.value=v),columns:S.value,actions:P,dataSource:p.value,onAction:L,onChange:b,onReload:g},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const ce=H(le,[["__scopeId","data-v-590d7382"]]),de={class:"page"},re=J({__name:"index",setup(Q){const h=q();se();const u=K();_(()=>u.getUserInfo.team);const d=_(()=>u.getUserInfo.role);_(()=>u.getUserInfo.lob);const S=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(e,n)=>{if(n.project){const l=[];return n.checkListId&&l.push("Check List"),l.join(" | ")}else return`${n.checkListUploaded} / ${n.checkListTotal}`}}],P=e=>e.id,A={width:"260px",actions:[{title:"Preview",type:"default",key:"preview",isShow:e=>e.project!=null&&e.checkListId!=null},{title:"Upload",type:"info",key:"update",isShow:e=>e.part===void 0&&(d.value==="super_admin"||d.value==="admin"||d.value==="lob_dri")}],more:[]};o({});const k=o(1),w=o(15),p=T({}),m=o([]),g=o(!0),L=async()=>{g.value=!0;try{const e=await C("/mde/get_lines_tree",{deepth:"project",pageNum:k.value,pageSize:w.value,...p});m.value=e}finally{g.value=!1}},b=(e,n)=>{e==="preview"?Y(n,"default"):e==="update"?G(n):e==="delete"&&X(n)},c=o(null),i=()=>{c.value.show()},I=e=>{function n(y){var N=y.lastIndexOf("/"),U=y.lastIndexOf("\\"),j=Math.max(N,U);return j<0?y:y.substring(j+1)}const l=document.createElement("a");l.download=n(e),l.style.display="none",l.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+e,document.body.appendChild(l),l.click(),document.body.removeChild(l)},f=o(null),v=o(!1),t=T({}),x=_(()=>t.lob&&t.site&&t.productLine&&t.project?`${t.lob}_${t.site}_${t.productLine}_${t.project}.json`:null),V=async()=>{t.lob=p.lob,t.site=p.site,t.productLine=p.productLine,t.project=p.project,t.type="default",f.value.show()},G=e=>{t.auditType=e.auditType,t.lob=e.lob,t.site=e.site,t.productLine=e.productLine,t.project=e.project,t.type="default",f.value.show()},W=async()=>{v.value=!0;try{await C("/mde/upload_check_list",t),h.success("Uploaded"),f.value.close(),L()}finally{v.value=!1}},X=async e=>{h.loading("Deleting"),await C("/mde/delete_check_list",{id:e.id}),h.success("Deleted"),f.value.close(),L()},$=o(),z=o(),Y=async(e,n)=>{$.value.show(),await ne(),z.value.setup(e,n)};return(e,n)=>{const l=a("AAListButtonAdd"),y=a("AAListButtonDownload"),N=a("AAListHandlers"),U=a("AAPageList"),j=a("n-card"),B=a("AADialog"),Z=a("AAFormSiteProjectNopart"),E=a("n-grid-item"),ee=a("AAFormSelectJson"),te=a("n-grid"),oe=a("AAFormDialog");return M(),O("div",de,[s(j,null,{default:r(()=>[s(N,null,{default:r(()=>[s(l,{title:"Upload",onClick:V}),s(y,{title:"Check List Templates",onClick:i})]),_:1}),s(U,{isPaged:!1,isLoading:g.value,columns:S,actions:A,dataSource:m.value,childrenKey:"sub",rowKey:P,onReady:L,onAction:b,onReload:L},null,8,["isLoading","dataSource"])]),_:1}),s(B,{ref_key:"templatesDialogRef",ref:c,title:"Check List Templates",width:"320px"},{default:r(()=>[F("div",{class:"download-link",onClick:n[0]||(n[0]=ue=>I("team_MDE/files/Check_List_Template.json"))},"Check List Template")]),_:1},512),s(oe,{ref_key:"editDialogRef",ref:f,title:"Upload Check List",width:"400px",isLoading:v.value,form:t,onConfirm:W},{default:r(()=>[s(te,{cols:"1"},{default:r(()=>[s(E,null,{default:r(()=>[s(Z,{isRequired:!0,selectParent:!1,label:"Site Project",form:t,team:"MDE",siteProjects:m.value},null,8,["form","siteProjects"])]),_:1}),s(E,null,{default:r(()=>[s(ee,{disabled:!t.project,isRequired:!0,label:"JSON Spec File",form:t,formKey:"rawJson",validateName:R(x),tips:"The JSON file must match the line selected"+(R(x)?", and with name '"+R(x)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),s(B,{ref_key:"previewDialogRef",ref:$,title:"Check List"},{default:r(()=>[s(ce,{ref_key:"previewRef",ref:z},null,512)]),_:1},512)])}}});const _e=H(re,[["__scopeId","data-v-3d88b8cd"]]);export{_e as default};
