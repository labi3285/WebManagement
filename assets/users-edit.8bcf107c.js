import{d as ie,m as ue,p as re,r as d,q as w,f as q,j as i,o as y,c as de,y as o,z as l,i as c,k as h,B as F,x as f,U as T,_ as ce}from"./index.de841f12.js";const me={class:"page"},_e=ie({__name:"users-edit",setup(fe){const p=ue(),g=re(),U=[{value:"mqa",label:"MQA"},{value:"accessory",label:"Accessory"},{value:"display",label:"Display"}],A=[{value:"admin",label:"Admin"},{value:"lob_dri",label:"LOB DRI"},{value:"lob_auditor",label:"LOB Auditor"}],b=d([]);async function k(){const e=n.team||s.team,a=await f("/get_level_lines",{team:e});b.value=a.map(u=>u.lob)}const I=w(()=>g.getUserInfo.team),t=w(()=>g.getUserInfo.role),z=w(()=>g.getUserInfo.lob),Q=w(()=>g.getUserInfo.id),M=[{title:"Account",key:"account",width:200},{title:"Team",key:"team",width:200,isShow:()=>t.value==="super_admin"},{title:"Role",key:"role",width:100,tagOptions:{valueLabels:A,valueTypes:[{value:"admin",type:"error"},{value:"lob_dri",type:"warning"},{value:"lob_auditor",type:"info"}]}},{title:"LOB",key:"lob",width:200,valueFormator:e=>e?e.join(","):""},{title:"Enable",key:"status",width:80,switch:{isNumber:!0,isDisabled:e=>t.value!=="super_admin"&&t.value!=="admin"&&(t.value==="lob_dri"&&e.role==="lob_dri"||t.value!=="lob_dri"||e.id===Q.value)}},{title:"Create Time",key:"createTime",width:200}],j={actions:[{title:"Change Role",type:"warning",key:"role",isShow:e=>t.value==="super_admin"||t.value==="admin"&&e.role!=="super_admin"&&e.role!=="admin"||t.value==="lob_dri"&&e.role==="lob_auditor"}],more:[{title:"Reset Password",type:"error",key:"reset_password",confirm:{targetKey:"account"},isShow:e=>t.value==="super_admin"||t.value==="admin"&&e.role!=="super_admin"&&e.role!=="admin"||t.value==="lob_dri"&&e.role==="lob_auditor"}]},H=d({}),R=d(1),B=d(15),s=q({});t.value==="super_admin"?s.team="mqa":s.team=I.value;const P=d({total:0,list:[]}),L=d(!0),V=()=>{t.value==="super_admin"?s.team="mqa":s.team=I.value,s.account=null,R.value=1},m=async()=>{L.value=!0;try{const e=await f("/get_users_page",{pageNum:R.value,pageSize:B.value,...s});P.value=e}finally{L.value=!1}},$=(e,a)=>{e==="role"?Z(a):e==="reset_password"?X(a):e==="delete"&&Y(a)},G=async(e,a)=>{if(e==="status"){const u=a[e];try{await f("/update_user_status",{id:a.id,status:u})}catch{a[e]=u===1?0:1}}},v=d(null),D=d(!1),n=q({}),J=async e=>{e?T(n,e):t.value==="lob_dri"?(n.role="lob_auditor",n.lob=z.value):T(n,null),n.team=s.team,v.value.show()},W=async()=>{D.value=!0;try{await f("/add_user",n),p.success("Add Success"),v.value.close(),m()}finally{D.value=!1}},X=async e=>{p.loading("Reseting"),await f("/reset_user_password",{id:e.id}),p.success("Password Resetted"),v.value.close(),m()},Y=async e=>{p.loading("Deleting"),await f("/delete_user",{id:e.id}),p.success("Deleted"),v.value.close(),m()};d([]);const C=d(!1),E=d(null),_=q({});async function Z(e){T(_,{id:e.id,role:e.role,lob:e.lob}),E.value.show()}async function ee(){C.value=!0;try{await f("/change_user_role",_),p.success("Edit Success"),E.value.close(),m()}finally{C.value=!1}}return(e,a)=>{const u=i("AAFormSelect"),r=i("n-grid-item"),x=i("AAFormInputText"),oe=i("AAFormQueryButtons"),K=i("n-grid"),te=i("AAForm"),le=i("AAListButtonAdd"),ae=i("AAListHandlers"),se=i("AAPageList"),ne=i("n-card"),N=i("AAFormSelectMultiple"),O=i("AAFormDialog");return y(),de("div",me,[o(ne,null,{default:l(()=>[o(te,{labelPlacement:"left",isLoading:L.value,form:s,rules:H.value},{default:l(()=>[o(K,{cols:"1 400:2 800:3 1000:4"},{default:l(()=>[c(t)==="super_admin"?(y(),h(r,{key:0},{default:l(()=>[o(u,{label:"Team",form:s,formKey:"team",options:U},null,8,["form"])]),_:1})):F("",!0),o(r,null,{default:l(()=>[o(x,{label:"Account",form:s,formKey:"account"},null,8,["form"])]),_:1}),o(r,null,{default:l(()=>[o(u,{label:"Role",form:s,formKey:"role",options:A,onShow:k},null,8,["form"])]),_:1}),o(r,null,{default:l(()=>[o(u,{label:"LOB",form:s,formKey:"lob",options:b.value},null,8,["form","options"])]),_:1}),o(r,null,{default:l(()=>[o(oe,{onQuery:m,onReset:V})]),_:1})]),_:1})]),_:1},8,["isLoading","form","rules"]),o(ae,null,{default:l(()=>[o(le,{title:c(t)==="lob_dri"?"Add Auditor":"Add User",onClick:a[0]||(a[0]=S=>J(null))},null,8,["title"])]),_:1}),o(se,{isLoading:L.value,pageNum:R.value,"onUpdate:pageNum":a[1]||(a[1]=S=>R.value=S),pageSize:B.value,"onUpdate:pageSize":a[2]||(a[2]=S=>B.value=S),columns:M,actions:j,dataSource:P.value,onReady:m,onAction:$,onChange:G,onReload:m},null,8,["isLoading","pageNum","pageSize","dataSource"])]),_:1}),o(O,{ref_key:"editDialogRef",ref:v,what:c(t)==="lob_dri"?"Auditor":"User",isLoading:D.value,form:n,onConfirm:W},{default:l(()=>[o(K,{cols:"1"},{default:l(()=>[c(t)==="super_admin"?(y(),h(r,{key:0},{default:l(()=>[o(u,{isRequired:!0,label:"Team",form:n,formKey:"team",options:U},null,8,["form"])]),_:1})):F("",!0),o(r,null,{default:l(()=>[o(x,{isRequired:!0,label:"Account",form:n,formKey:"account"},null,8,["form"])]),_:1}),o(r,null,{default:l(()=>[o(u,{disabled:c(t)!=="super_admin"&&c(t)!=="admin",isRequired:!0,label:"Role",form:n,formKey:"role",options:A},null,8,["disabled","form"])]),_:1}),n.role!=="admin"?(y(),h(r,{key:1},{default:l(()=>[o(N,{disabled:c(t)!=="super_admin"&&c(t)!=="admin",isRequired:!0,label:"LOB",form:n,formKey:"lob",onShow:k,options:b.value},null,8,["disabled","form","options"])]),_:1})):F("",!0)]),_:1})]),_:1},8,["what","isLoading","form"]),o(O,{ref_key:"editRoleDialogRef",ref:E,title:"Change Role",isLoading:C.value,form:_,onConfirm:ee},{default:l(()=>[o(K,{cols:"1"},{default:l(()=>[o(r,null,{default:l(()=>[o(u,{isRequired:!0,label:"Role",form:_,formKey:"role",options:A},null,8,["form"])]),_:1}),_.role!=="super_admin"&&_.role!=="admin"?(y(),h(r,{key:0},{default:l(()=>[o(N,{isRequired:!0,label:"LOB",form:_,formKey:"lob",options:b.value,onShow:k},null,8,["form","options"])]),_:1})):F("",!0)]),_:1})]),_:1},8,["isLoading","form"])])}}});const ve=ce(_e,[["__scopeId","data-v-f38775fe"]]);export{ve as default};
