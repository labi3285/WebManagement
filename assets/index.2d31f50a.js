import{d as q,m as E,p as K,r as i,q as _,f as F,x as I,j as n,o as O,c as H,a as P,A as D,y as o,z as u,_ as M,l as oe,i as R,T as le}from"./index.9dc4264c.js";const ne={class:"view"},ae={class:"head-info"},ce=q({__name:"items",setup(Q,{expose:k}){E();const p=K(),d=i({});_(()=>p.getUserInfo.team),_(()=>p.getUserInfo.role),_(()=>p.getUserInfo.lob),_(()=>p.getUserInfo.id),k({setup:async(r,l)=>{d.value=r,l==="Glue"?f.checkListId=r.checkListId_Glue:l==="Destructive"&&(f.checkListId=r.checkListId_Destructive),f.type=l,l=="Glue"?A.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"USL",key:"USL",width:100},{title:"LSL",key:"LSL",width:100}]:l=="Destructive"&&(A.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100}]),g()}});const A=i([]),U={actions:[]};i({});const w=i(1),S=i(15),f=F({}),c=i({total:0,list:[]}),y=i(!0),g=async()=>{y.value=!0;try{const r=await I("/accessory/get_check_list_items_page",{pageNum:w.value,pageSize:S.value,...f});c.value=r}finally{y.value=!1}},h=(r,l)=>{},b=async(r,l)=>{};return(r,l)=>{const C=n("AAPageList"),m=n("n-card");return O(),H("div",ne,[P("div",ae,[P("p",null,D(d.value.lob)+" / "+D(d.value.site)+" / "+D(d.value.productLine)+" / "+D(d.value.project)+" / "+D(d.value.part),1)]),o(m,null,{default:u(()=>[o(C,{isLoading:y.value,pageNum:w.value,"onUpdate:pageNum":l[0]||(l[0]=v=>w.value=v),pageSize:S.value,"onUpdate:pageSize":l[1]||(l[1]=v=>S.value=v),columns:A.value,actions:U,dataSource:c.value,onAction:h,onChange:b,onReload:g},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const re=M(ce,[["__scopeId","data-v-4718882c"]]),de={class:"page"},ue=q({__name:"index",setup(Q){const k=E();oe();const p=K();_(()=>p.getUserInfo.team);const d=_(()=>p.getUserInfo.role);_(()=>p.getUserInfo.lob);const A=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(e,s)=>{if(s.part){const a=[];return s.checkListId_Glue&&a.push("Glue"),s.checkListId_Destructive&&a.push("Destructive"),a.join(" | ")}else return`${s.checkListUploaded} / ${s.checkListTotal}`}}],U=e=>e.id,w={width:"260px",actions:[{title:"Preview Glue",type:"default",key:"previewGlue",isShow:e=>e.part!=null&&e.checkListId_Glue!=null},{title:"Preview Destructive",type:"default",key:"previewDestructive",isShow:e=>e.part!=null&&e.checkListId_Destructive!=null},{title:"Upload",type:"info",key:"update",isShow:e=>d.value==="super_admin"||d.value==="admin"||d.value==="lob_dri"}],more:[]};i({});const S=i(1),f=i(15),c=F({}),y=i([]),g=i(!0),h=async()=>{g.value=!0;try{const e=await I("/accessory/get_lines_tree",{pageNum:S.value,pageSize:f.value,...c});y.value=e}finally{g.value=!1}},b=(e,s)=>{e==="previewGlue"?z(s,"Glue"):e==="previewDestructive"?z(s,"Destructive"):e==="update"?W(s):e==="delete"&&Y(s)},r=i(null),l=()=>{r.value.show()},C=e=>{function s(L){var N=L.lastIndexOf("/"),T=L.lastIndexOf("\\"),j=Math.max(N,T);return j<0?L:L.substring(j+1)}const a=document.createElement("a");a.download=s(e),a.style.display="none",a.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+e,document.body.appendChild(a),a.click(),document.body.removeChild(a)},m=i(null),v=i(!1),t=F({}),x=_(()=>t.lob&&t.site&&t.productLine&&t.project&&t.part?`${t.lob}_${t.site}_${t.productLine}_${t.project}_${t.part}.json`:null),V=async()=>{t.lob=c.lob,t.site=c.site,t.productLine=c.productLine,t.project=c.project,t.part=c.part,c.project?t.type=c.project:t.type=null,m.value.show()},W=e=>{t.auditType=e.auditType,t.lob=e.lob,t.site=e.site,t.productLine=e.productLine,t.project=e.project,t.part=e.part,t.type=e.project,m.value.show()},X=async()=>{v.value=!0;try{await I("/accessory/upload_check_list",t),k.success("Uploaded"),m.value.close(),h()}finally{v.value=!1}},Y=async e=>{k.loading("Deleting"),await I("/accessory/delete_check_list",{id:e.id}),k.success("Deleted"),m.value.close(),h()},G=i(),$=i(),z=async(e,s)=>{G.value.show(),await le(),$.value.setup(e,s)};return(e,s)=>{const a=n("AAListButtonAdd"),L=n("AAListButtonDownload"),N=n("AAListHandlers"),T=n("AAPageList"),j=n("n-card"),B=n("AADialog"),Z=n("AAFormSiteProject"),J=n("n-grid-item"),ee=n("AAFormSelectJson"),te=n("n-grid"),se=n("AAFormDialog");return O(),H("div",de,[o(j,null,{default:u(()=>[o(N,null,{default:u(()=>[o(a,{title:"Upload",onClick:V}),o(L,{title:"Check List Templates",onClick:l})]),_:1}),o(T,{isPaged:!1,isLoading:g.value,columns:A,actions:w,dataSource:y.value,childrenKey:"sub",rowKey:U,onReady:h,onAction:b,onReload:h},null,8,["isLoading","dataSource"])]),_:1}),o(B,{ref_key:"templatesDialogRef",ref:r,title:"Check List Templates",width:"320px"},{default:u(()=>[P("div",{class:"download-link",onClick:s[0]||(s[0]=ie=>C("team_Accessory/files/Check_List_Template_Glue.json"))},"Glue Check List Template"),P("div",{class:"download-link",onClick:s[1]||(s[1]=ie=>C("team_Accessory/files/Check_List_Template_Destructive.json"))},"Destructive Check List Template")]),_:1},512),o(se,{ref_key:"editDialogRef",ref:m,title:"Upload Check List",width:"400px",isLoading:v.value,form:t,onConfirm:X},{default:u(()=>[o(te,{cols:"1"},{default:u(()=>[o(J,null,{default:u(()=>[o(Z,{isRequired:!0,selectParent:!1,label:"Site Project",form:t,team:"Accessory"},null,8,["form"])]),_:1}),o(J,null,{default:u(()=>[o(ee,{disabled:!t.part,isRequired:!0,label:"JSON Spec File",form:t,formKey:"rawJson",validateName:R(x),tips:"The JSON file must match the line selected"+(R(x)?", and with name '"+R(x)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),o(B,{ref_key:"previewDialogRef",ref:G,title:"Preview"},{default:u(()=>[o(re,{ref_key:"previewRef",ref:$},null,512)]),_:1},512)])}}});const _e=M(ue,[["__scopeId","data-v-dc374f65"]]);export{_e as default};
