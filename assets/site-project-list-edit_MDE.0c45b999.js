import{d as Ae,m as je,l as he,p as Se,q as P,r as t,f as $,j as u,o as L,c as Pe,y as s,z as i,i as d,k,B as C,x as _,_ as ke}from"./index.9dc4264c.js";const Ce={class:"page"},De=Ae({__name:"site-project-list-edit_MDE",setup(Ee){const D=je();he();const c=Se(),G=[{value:"lob",label:"LOB"},{value:"site",label:"Site"},{value:"productLine",label:"Product Line"},{value:"project",label:"Project"}];P(()=>c.getUserInfo.team);const a=P(()=>c.getUserInfo.role),E=P(()=>c.getUserInfo.lob),J=e=>{if(E.value){for(const r of E.value)if(r===e)return!0}return!1},W=async()=>{const e=await _("/refresh_user",{});c.setToken(e.token),c.setUserInfo(e.user)},X=[{title:"Site Project Tree",key:"name",align:"left",width:500}],Y=e=>e.id,Z={actions:[{title:"Add Sub",type:"info",key:"add_sub",isShow:e=>!e.project&&(a.value==="super_admin"||a.value==="admin"||a.value==="lob_dri")}],more:[{title:"Delete",type:"error",key:"delete",confirm:{type:"delete",targetName:e=>e.project?e.project:e.productLine?e.productLine:e.site?e.site:e.lob?e.lob:null,additionalText:"Delete line will delete sub lines together, and this action cannot be undone!"},isShow:e=>a.value==="super_admin"||a.value==="admin"||a.value==="lob_dri"&&e.role!=="supper_admin"&&e.role!=="admin"&&e.role!="lob_dri"&&J(e.lob)}]};t({});const ee=t(1),le=t(15),o=$({}),R=async e=>await _("/mde/get_level_lines",e),f=t([]),x=t(!1),v=t(!1),te=async()=>{if(!v.value){x.value=!0;try{f.value=(await R({})).map(e=>({value:e.lob,label:e.lob})),v.value=!0}finally{x.value=!1}}},T=()=>{(a.value==="super_admin"||a.value==="admin")&&(f.value=[],v.value=!1,o.lob=null),O.value=[],U.value=!1,o.site=null,q.value=[],M.value=!1,o.productLine=null,w.value=[],z.value=!1,o.project=null},oe=()=>{O.value=[],U.value=!1,o.site=null,q.value=[],M.value=!1,o.productLine=null,w.value=[],z.value=!1,o.project=null},O=t([]);t(!1);const U=t(!1),q=t([]);t(!1);const M=t(!1),w=t([]);t(!1);const z=t(!1),H=t([]),B=t(!0),g=async()=>{B.value=!0;try{const e=await _("/mde/get_lines_tree",{pageNum:ee.value,pageSize:le.value,...o});H.value=e}finally{B.value=!1}},ae=(e,r)=>{e==="add_sub"?ce(r):e==="delete"&&ve(r)},p=t(null),F=t(!1),l=$({}),V=()=>{f.value=[],v.value=!1,l.lob=null,y.value=[],A.value=!1,l.site=null,m.value=[],b.value=!1,l.productLine=null,j.value=[],h.value=!1,l.project=null},ne=()=>{y.value=[],A.value=!1,l.site=null,m.value=[],b.value=!1,l.productLine=null,j.value=[],h.value=!1,l.project=null},y=t([]),K=t(!1),A=t(!1),se=async()=>{if(!A.value){K.value=!0;try{y.value=(await R({lob:l.lob})).map(e=>({value:e.site,label:e.site})),A.value=!0}finally{K.value=!1}}},ue=()=>{m.value=[],b.value=!1,l.productLine=null,j.value=[],h.value=!1,l.project=null},m=t([]),I=t(!1),b=t(!1),ie=async()=>{if(!b.value){I.value=!0;try{m.value=(await R({lob:l.lob,site:l.site})).map(e=>({value:e.productLine,label:e.productLine})),b.value=!0}finally{I.value=!1}}},re=()=>{j.value=[],h.value=!1,l.project=null},j=t([]);t(!1);const h=t(!1),Q=P(()=>{for(const e of G)if(e.value===n.value)return e.label;return n.value}),n=t(""),de=async e=>{n.value=e,e==="lob"?(l.lob=null,l.site=null,l.productLine=null,l.project=null):e==="site"?(l.lob=o.lob,l.site=null,l.productLine=null,l.project=null):e==="productLine"?(l.lob=o.lob,l.site=o.site,l.productLine=null,l.project=null):e==="project"?(l.lob=o.lob,l.site=o.site,l.productLine=o.productLine,l.project=null):(l.lob=o.lob,l.site=o.site,l.productLine=o.productLine,l.project=o.project),p.value.show()},ce=e=>{e.productLine?(n.value="project",l.lob=e.lob,l.site=e.site,l.productLine=e.productLine,l.project=null):e.site?(n.value="productLine",l.lob=e.lob,l.site=e.site,l.productLine=null,l.project=null):e.lob&&(n.value="site",l.lob=e.lob,l.site=null,l.productLine=null,l.project=null),p.value.show()},fe=async()=>{F.value=!0;try{await _("/mde/add_line",l),D.success("Add Success"),p.value.close(),g(),T(),V(),n.value==="lob"&&a.value==="lob_dri"&&W()}finally{F.value=!1}},ve=async e=>{D.loading("Deleting"),await _("/mde/delete_line",{id:e.id}),D.success("Deleted"),p.value.close(),g(),T(),V()};if(a.value!=="super_admin"&&a.value!=="admin"){const e=E.value||"";f.value=[{value:e,label:e}],v.value=!0,o.lob=e,oe()}return(e,r)=>{const pe=u("AAListButtonAdd"),me=u("AAListHandlers"),be=u("AAPageList"),Le=u("n-card"),N=u("AAFormSelect"),S=u("n-grid-item"),_e=u("AAFormInputText"),ge=u("n-grid"),ye=u("AAFormDialog");return L(),Pe("div",Ce,[s(Le,null,{default:i(()=>[s(me,null,{default:i(()=>[d(a)==="super_admin"||d(a)==="admin"||d(a)==="lob_dri"?(L(),k(pe,{key:0,title:"Add LOB",onClick:r[0]||(r[0]=Re=>de("lob"))})):C("",!0)]),_:1}),s(be,{isPaged:!1,isLoading:B.value,columns:X,actions:Z,dataSource:H.value,childrenKey:"sub",rowKey:Y,onReady:g,onAction:ae,onReload:g},null,8,["isLoading","dataSource"])]),_:1}),s(ye,{ref_key:"editDialogRef",ref:p,what:d(Q),isLoading:F.value,form:l,onConfirm:fe},{default:i(()=>[s(ge,{cols:"1"},{default:i(()=>[n.value!=="lob"?(L(),k(S,{key:0},{default:i(()=>[s(N,{disabled:d(a)!=="super_admin"&&d(a)!=="admin",isRequired:!0,label:"LOB",form:l,formKey:"lob",options:f.value,loading:x.value,onChange:ne,onShow:te},null,8,["disabled","form","options","loading"])]),_:1})):C("",!0),n.value==="productLine"||n.value==="project"?(L(),k(S,{key:1},{default:i(()=>[s(N,{disabled:!l.lob,isRequired:!0,label:"Site",form:l,formKey:"site",options:y.value,loading:K.value,onChange:ue,onShow:se},null,8,["disabled","form","options","loading"])]),_:1})):C("",!0),n.value==="project"?(L(),k(S,{key:2},{default:i(()=>[s(N,{disabled:!l.site,isRequired:!0,label:"Product Line",form:l,formKey:"productLine",options:m.value,loading:I.value,onChange:re,onShow:ie},null,8,["disabled","form","options","loading"])]),_:1})):C("",!0),s(S,null,{default:i(()=>[s(_e,{isRequired:!0,label:d(Q)+" Name",form:l,formKey:n.value},null,8,["label","form","formKey"])]),_:1})]),_:1})]),_:1},8,["what","isLoading","form"])])}}});const Be=ke(De,[["__scopeId","data-v-0d96aaf8"]]);export{Be as default};
