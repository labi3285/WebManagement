import{d as J,m as K,p as H,r as o,q as m,f as B,x as U,j as n,o as M,c as Q,a as x,A as D,y as i,z as p,T as ie,G as oe,H as le,_ as V,l as ae,i as G,U as ne}from"./index.74f2624c.js";const ce=y=>(oe("data-v-23cb66c2"),y=y(),le(),y),re={class:"view"},de={class:"head-info"},ue=ce(()=>x("div",{class:"flex-space"},null,-1)),pe=J({__name:"items",setup(y,{expose:g}){const v=K(),f=H(),c=o({});m(()=>f.getUserInfo.team),m(()=>f.getUserInfo.role),m(()=>f.getUserInfo.lob),m(()=>f.getUserInfo.id),g({setup:async(l,a)=>{c.value=l,a==="Glue"?u.checkListId=l.checkListId_Glue:a==="Destructive"&&(u.checkListId=l.checkListId_Destructive),u.type=a,a=="Glue"?k.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]:a=="Destructive"&&(k.value=[{title:"SN",key:"sn",width:60},{title:"Class",key:"theClass",width:80},{title:"Line&Shift",key:"lineShift",width:200},{title:"Site",key:"site",width:200},{title:"Projects",key:"projects",width:200},{title:"Item",key:"item",width:200},{title:"Unit",key:"unit",width:100},{title:"LSL",key:"LSL",width:100},{title:"USL",key:"USL",width:100}]),I()}});const k=o([]),b={actions:[]};o({});const A=o(1),r=o(15),u=B({}),L=o({total:0,list:[]}),_=o(!0),I=async()=>{_.value=!0;try{const l=await U("/accessory/get_check_list_items_page",{pageNum:A.value,pageSize:r.value,...u});L.value=l}finally{_.value=!1}},C=(l,a)=>{},N=async(l,a)=>{},P=async()=>{v.loading("Processing");const l=c.value.lob+"_"+c.value.site+"_"+c.value.productLine+"_"+c.value.project+"_"+c.value.part+".xlsx";await ie("/accessory/export_check_list_items",{checkListId:u.checkListId,type:u.type},l),v.destroyAll()};return(l,a)=>{const e=n("AAListButtonDownload"),w=n("AAPageList"),R=n("n-card");return M(),Q("div",re,[x("div",de,[x("p",null,D(c.value.lob)+" / "+D(c.value.site)+" / "+D(c.value.productLine)+" / "+D(c.value.project)+" / "+D(c.value.part),1),ue,i(e,{title:"Export",onClick:P})]),i(R,null,{default:p(()=>[i(w,{isLoading:_.value,pageNum:A.value,"onUpdate:pageNum":a[0]||(a[0]=S=>A.value=S),pageSize:r.value,"onUpdate:pageSize":a[1]||(a[1]=S=>r.value=S),columns:k.value,actions:b,dataSource:L.value,onAction:C,onChange:N,onReload:I},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const _e=V(pe,[["__scopeId","data-v-23cb66c2"]]),me={class:"page"},ve=J({__name:"index",setup(y){const g=K();ae();const v=H();m(()=>v.getUserInfo.team),m(()=>v.getUserInfo.role),m(()=>v.getUserInfo.lob);const f=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(t,s)=>{if(s.part){const d=[];return s.checkListId_Glue&&d.push("Glue"),s.checkListId_Destructive&&d.push("Destructive"),d.join(" | ")}else return`${s.checkListUploaded} / ${s.checkListTotal}`}}],c=t=>t.id,k={width:"260px",actions:[{title:"Preview Glue",type:"default",key:"previewGlue",isShow:t=>t.part!=null&&t.checkListId_Glue!=null},{title:"Preview Destructive",type:"default",key:"previewDestructive",isShow:t=>t.part!=null&&t.checkListId_Destructive!=null},{title:"Upload",type:"info",key:"update"}],more:[]};o({});const b=o(1),A=o(15),r=B({}),u=o([]),L=o(!0),_=async()=>{L.value=!0;try{const t=await U("/accessory/get_lines_tree",{pageNum:b.value,pageSize:A.value,...r});u.value=t}finally{L.value=!1}},I=(t,s)=>{t==="previewGlue"?z(s,"Glue"):t==="previewDestructive"?z(s,"Destructive"):t==="update"?S(s):t==="delete"&&X(s)},C=o(null),N=()=>{C.value.show()},P=t=>{function s(h){var T=h.lastIndexOf("/"),F=h.lastIndexOf("\\"),j=Math.max(T,F);return j<0?h:h.substring(j+1)}const d=document.createElement("a");d.download=s(t),d.style.display="none",d.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+t,document.body.appendChild(d),d.click(),document.body.removeChild(d)},l=o(null),a=o(!1),e=B({}),w=m(()=>e.lob&&e.site&&e.productLine&&e.project&&e.part?`${e.lob}_${e.site}_${e.productLine}_${e.project}_${e.part}`:null),R=async()=>{e.lob=r.lob,e.site=r.site,e.productLine=r.productLine,e.project=r.project,e.part=r.part,r.project?e.type=r.project:e.type=null,l.value.show()},S=t=>{e.auditType=t.auditType,e.lob=t.lob,e.site=t.site,e.productLine=t.productLine,e.project=t.project,e.part=t.part,e.type=t.project,l.value.show()},W=async()=>{a.value=!0;try{await U("/accessory/upload_check_list",e),g.success("Uploaded"),l.value.close(),_()}finally{a.value=!1}},X=async t=>{g.loading("Deleting"),await U("/accessory/delete_check_list",{id:t.id}),g.success("Deleted"),l.value.close(),_()},$=o(),E=o(),z=async(t,s)=>{$.value.show(),await ne(),E.value.setup(t,s)};return(t,s)=>{const d=n("AAListButtonAdd"),h=n("AAListButtonDownload"),T=n("AAListHandlers"),F=n("AAPageList"),j=n("n-card"),O=n("AADialog"),Y=n("AAFormSiteProject"),q=n("n-grid-item"),Z=n("AAFormSelectJsonWithExcel"),ee=n("n-grid"),te=n("AAFormDialog");return M(),Q("div",me,[i(j,null,{default:p(()=>[i(T,null,{default:p(()=>[i(d,{title:"Upload",onClick:R}),i(h,{title:"Check List Templates",onClick:N})]),_:1}),i(F,{isPaged:!1,isLoading:L.value,columns:f,actions:k,dataSource:u.value,childrenKey:"sub",rowKey:c,onReady:_,onAction:I,onReload:_},null,8,["isLoading","dataSource"])]),_:1}),i(O,{ref_key:"templatesDialogRef",ref:C,title:"Check List Templates",width:"320px"},{default:p(()=>[x("div",{class:"download-link",onClick:s[0]||(s[0]=se=>P("team_Accessory/files/LOB_Site_ProductLine_Glue_Line.xlsx"))},"Glue Check List Template"),x("div",{class:"download-link",onClick:s[1]||(s[1]=se=>P("team_Accessory/files/LOB_Site_ProductLine_Destructive_Line.xlsx"))},"Destructive Check List Template")]),_:1},512),i(te,{ref_key:"editDialogRef",ref:l,title:"Upload Check List",width:"400px",isLoading:a.value,form:e,onConfirm:W},{default:p(()=>[i(ee,{cols:"1"},{default:p(()=>[i(q,null,{default:p(()=>[i(Y,{isRequired:!0,selectParent:!1,label:"Site Project",form:e,team:"Accessory",siteProjects:u.value},null,8,["form","siteProjects"])]),_:1}),i(q,null,{default:p(()=>[i(Z,{disabled:!e.part,isRequired:!0,label:"Spec Excel/JSON File",form:e,formKey:"rawJson",validateName:G(w),tips:"The file must match the line selected"+(G(w)?", and with name '"+G(w)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),i(O,{ref_key:"previewDialogRef",ref:$,title:"Check List"},{default:p(()=>[i(_e,{ref_key:"previewRef",ref:E},null,512)]),_:1},512)])}}});const Le=V(ve,[["__scopeId","data-v-1a2fea43"]]);export{Le as default};
