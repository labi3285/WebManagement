import{d as K,m as M,p as O,r as s,q as _,f as B,x as j,j as l,o as H,c as Q,a as C,A as I,y as o,z as u,T as oe,G as se,H as ne,_ as V,l as ae,i as E,U as ie}from"./index.74f2624c.js";const le=h=>(se("data-v-2c268312"),h=h(),ne(),h),ce={class:"view"},de={class:"head-info"},re=le(()=>C("div",{class:"flex-space"},null,-1)),ue=K({__name:"items",setup(h,{expose:y}){const f=M(),v=O(),c=s({});_(()=>v.getUserInfo.team),_(()=>v.getUserInfo.role),_(()=>v.getUserInfo.lob),_(()=>v.getUserInfo.id),y({setup:async(n,i)=>{c.value=n,i==="default"&&(m.checkListId=n.checkListId),m.type=i,i=="default"&&(S.value=[{title:"SN",key:"sn",width:60},{title:"Station",key:"station",width:200},{title:"Process",key:"process",width:400},{title:"Product line",key:"productLine",width:200},{title:"Project",key:"project",width:200},{title:"Check Item",key:"checkItem",width:400},{title:"USL",key:"USL",width:100},{title:"LSL",key:"LSL",width:100}]),x()}});const S=s([]),b={actions:[]};s({});const A=s(1),r=s(15),m=B({}),g=s({total:0,list:[]}),p=s(!0),x=async()=>{p.value=!0;try{const n=await j("/mde/get_check_list_items_page",{pageNum:A.value,pageSize:r.value,...m});g.value=n}finally{p.value=!1}},D=(n,i)=>{},U=async(n,i)=>{},N=async()=>{f.loading("Processing");const n=c.value.lob+"_"+c.value.site+"_"+c.value.productLine+"_"+c.value.project+".xlsx";await oe("/mde/export_check_list_items",{checkListId:c.value.checkListId},n),f.destroyAll()};return(n,i)=>{const t=l("AAListButtonDownload"),k=l("AAPageList"),R=l("n-card");return H(),Q("div",ce,[C("div",de,[C("p",null,I(c.value.lob)+" / "+I(c.value.site)+" / "+I(c.value.productLine)+" / "+I(c.value.project),1),re,o(t,{title:"Export",onClick:N})]),o(R,null,{default:u(()=>[o(k,{isLoading:p.value,pageNum:A.value,"onUpdate:pageNum":i[0]||(i[0]=w=>A.value=w),pageSize:r.value,"onUpdate:pageSize":i[1]||(i[1]=w=>r.value=w),columns:S.value,actions:b,dataSource:g.value,onAction:D,onChange:U,onReload:x},null,8,["isLoading","pageNum","pageSize","columns","dataSource"])]),_:1})])}}});const pe=V(ue,[["__scopeId","data-v-2c268312"]]),_e={class:"page"},me=K({__name:"index",setup(h){const y=M();ae();const f=O();_(()=>f.getUserInfo.team),_(()=>f.getUserInfo.role),_(()=>f.getUserInfo.lob);const v=[{title:"Site Project Tree",key:"name",align:"left",width:500},{title:"Check List",key:"checkListTotal",width:200,valueFormator:(e,a)=>{if(a.project){const d=[];return a.checkListId&&d.push("Check List"),d.join(" | ")}else return`${a.checkListUploaded} / ${a.checkListTotal}`}}],c=e=>e.id,S={width:"260px",actions:[{title:"Preview",type:"default",key:"preview",isShow:e=>e.project!=null&&e.checkListId!=null},{title:"Upload",type:"info",key:"update",isShow:e=>!e.part}],more:[]};s({});const b=s(1),A=s(15),r=B({}),m=s([]),g=s(!0),p=async()=>{g.value=!0;try{const e=await j("/mde/get_lines_tree",{deepth:"project",pageNum:b.value,pageSize:A.value,...r});m.value=e}finally{g.value=!1}},x=(e,a)=>{e==="preview"?X(a,"default"):e==="update"?w(a):e==="delete"&&G(a)},D=s(null),U=()=>{D.value.show()},N=e=>{function a(L){var F=L.lastIndexOf("/"),T=L.lastIndexOf("\\"),P=Math.max(F,T);return P<0?L:L.substring(P+1)}const d=document.createElement("a");d.download=a(e),d.style.display="none",d.href="https://usw2-mqasmartaudit-prod.apple.com/download_file?filePath="+e,document.body.appendChild(d),d.click(),document.body.removeChild(d)},n=s(null),i=s(!1),t=B({}),k=_(()=>t.lob&&t.site&&t.productLine&&t.project?`${t.lob}_${t.site}_${t.productLine}_${t.project}`:null),R=async()=>{t.lob=r.lob,t.site=r.site,t.productLine=r.productLine,t.project=r.project,t.type="default",n.value.show()},w=e=>{t.auditType=e.auditType,t.lob=e.lob,t.site=e.site,t.productLine=e.productLine,t.project=e.project,t.type="default",n.value.show()},W=async()=>{i.value=!0;try{await j("/mde/upload_check_list",t),y.success("Uploaded"),n.value.close(),p()}finally{i.value=!1}},G=async e=>{y.loading("Deleting"),await j("/mde/delete_check_list",{id:e.id}),y.success("Deleted"),n.value.close(),p()},$=s(),z=s(),X=async(e,a)=>{$.value.show(),await ie(),z.value.setup(e,a)};return(e,a)=>{const d=l("AAListButtonAdd"),L=l("AAListButtonDownload"),F=l("AAListHandlers"),T=l("AAPageList"),P=l("n-card"),q=l("AADialog"),Y=l("AAFormSiteProjectNopart"),J=l("n-grid-item"),Z=l("AAFormSelectJsonWithExcel"),ee=l("n-grid"),te=l("AAFormDialog");return H(),Q("div",_e,[o(P,null,{default:u(()=>[o(F,null,{default:u(()=>[o(d,{title:"Upload",onClick:R}),o(L,{title:"Check List Templates",onClick:U})]),_:1}),o(T,{isPaged:!1,isLoading:g.value,columns:v,actions:S,dataSource:m.value,childrenKey:"sub",rowKey:c,onReady:p,onAction:x,onReload:p},null,8,["isLoading","dataSource"])]),_:1}),o(q,{ref_key:"templatesDialogRef",ref:D,title:"Check List Templates",width:"320px"},{default:u(()=>[C("div",{class:"download-link",onClick:a[0]||(a[0]=fe=>N("team_MDE/files/LOB_Site_ProductLine_Project.xlsx"))},"Check List Template")]),_:1},512),o(te,{ref_key:"editDialogRef",ref:n,title:"Upload Check List",width:"400px",isLoading:i.value,form:t,onConfirm:W},{default:u(()=>[o(ee,{cols:"1"},{default:u(()=>[o(J,null,{default:u(()=>[o(Y,{isRequired:!0,selectParent:!1,label:"Site Project",form:t,team:"MDE",siteProjects:m.value},null,8,["form","siteProjects"])]),_:1}),o(J,null,{default:u(()=>[o(Z,{disabled:!t.project,isRequired:!0,label:"Spec Excel/JSON File",form:t,formKey:"rawJson",validateName:E(k),tips:"The file must match the line selected"+(E(k)?", and with name '"+E(k)+"'":"")},null,8,["disabled","form","validateName","tips"])]),_:1})]),_:1})]),_:1},8,["isLoading","form"]),o(q,{ref_key:"previewDialogRef",ref:$,title:"Check List"},{default:u(()=>[o(pe,{ref_key:"previewRef",ref:z},null,512)]),_:1},512)])}}});const ge=V(me,[["__scopeId","data-v-5b436ac9"]]);export{ge as default};
